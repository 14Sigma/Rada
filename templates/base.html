<!doctype html> 
<html lang="en-us"> 
  <head> 
    <meta charset="utf-8">
    <title>{title}</title> 
    <link rel="stylesheet" type="text/css" href="static/css/app.css" />
  </head>
  <body> 
    <div class="navbar navbar-fixed">
      <div class="navbar-inner">
        <div class="container">
          <p class="brand">Kujua Export <span class="version">v{settings.version}</span></p>
          <ul class="nav secondary-nav">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle">Admin</a>
              <ul class="dropdown-menu">
                <li><a href="{baseURL}/../_view/sms_messages?include_docs=true">Raw Messages</a></li>
                <li><a href="{baseURL}/test">Run Tests</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="page-header">
      <div class="container">
        <h1>SMS Forms Data</h1>
      </div>
    </div>
    <div class="container">
      <div class="content">
        <div id="content">
          {content|s}
        </div>
      </div>
      <div id="footer">
        <p>&copy; <span id="year">2011</span> Medic Mobile.</p>
      </div>
    </div>
    <script src="{baseURL}/static/js/jquery-1.5.2.min.js"></script>
    <script src="{baseURL}/static/js/json2.js"></script>
    <script src="{baseURL}/modules.js"></script>
    <script type="text/javascript">
        var db = require('db').current(),
            templates = require('duality/templates'),
            smsforms = require('views/lib/smsforms'),
            _ = require('underscore')._,
            forms = {}; 

        // render available downloads based on data available
        db.getView('kujua-export', 'sms_message_values', function(err, data) {
            if (err) {
                return alert(err);
            }
            for (var i = 0; i < data.rows.length; i++) {
                var key = data.rows[i].key[0];
                if (smsforms[key]) {
                  forms[key] = 1;
                }
            }
            $('#forms').html(
                templates.render(
                    'sms_forms_data.html', {}, {forms:_.keys(forms)}));
        });

        $(function() {
          // Dynamic year for footer copyright
          var currentYear = (new Date).getFullYear();
          $("#year").text( (new Date).getFullYear() );

          // Admin menu control
          $('.dropdown-toggle').click(function() {
            $('.dropdown-menu').toggle(300);
          });
        });
    </script>
  </body>
</html>

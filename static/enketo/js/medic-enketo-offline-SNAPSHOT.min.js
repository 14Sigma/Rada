/*
 almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/almond for details
 RequireJS text 2.0.10 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/text for details
 Copyright 2012 Martijn van de Rijdt & Modi Labs

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
   (C)2014
*/
var requirejs,require,define;
(function(g){function k(a,h){var n,q,v,m,b,d,f,l,u,k=h&&h.split("/"),t=e.map,w=t&&t["*"]||{};if(a&&"."===a.charAt(0))if(h){a=a.split("/");b=a.length-1;e.nodeIdCompat&&x.test(a[b])&&(a[b]=a[b].replace(x,""));a=k.slice(0,k.length-1).concat(a);for(b=0;b<a.length;b+=1)if(n=a[b],"."===n)a.splice(b,1),--b;else if(".."===n)if(1!==b||".."!==a[2]&&".."!==a[0])0<b&&(a.splice(b-1,2),b-=2);else break;a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((k||w)&&t){n=a.split("/");for(b=n.length;0<b;--b){q=
n.slice(0,b).join("/");if(k)for(u=k.length;0<u;--u)if(v=t[k.slice(0,u).join("/")])if(v=v[q]){m=v;d=b;break}if(m)break;!f&&w&&w[q]&&(f=w[q],l=b)}!m&&f&&(m=f,d=l);m&&(n.splice(0,d,m),a=n.join("/"))}return a}function f(a,e){return function(){var n=v.call(arguments,0);"string"!==typeof n[0]&&1===n.length&&n.push(null);return h.apply(g,n.concat([a,e]))}}function r(a){return function(e){return k(e,a)}}function d(a){return function(e){w[a]=e}}function b(e){if(q.call(l,e)){var h=l[e];delete l[e];n[e]=!0;
a.apply(g,h)}if(!q.call(w,e)&&!q.call(n,e))throw Error("No "+e);return w[e]}function t(a){var e,n=a?a.indexOf("!"):-1;-1<n&&(e=a.substring(0,n),a=a.substring(n+1,a.length));return[e,a]}function p(a){return function(){return e&&e.config&&e.config[a]||{}}}var a,h,m,u,w={},l={},e={},n={},q=Object.prototype.hasOwnProperty,v=[].slice,x=/\.js$/;m=function(a,e){var n,h=t(a),q=h[0];a=h[1];q&&(q=k(q,e),n=b(q));q?a=n&&n.normalize?n.normalize(a,r(e)):k(a,e):(a=k(a,e),h=t(a),q=h[0],a=h[1],q&&(n=b(q)));return{f:q?
q+"!"+a:a,n:a,pr:q,p:n}};u={require:function(a){return f(a)},exports:function(a){var e=w[a];return"undefined"!==typeof e?e:w[a]={}},module:function(a){return{id:a,uri:"",exports:w[a],config:p(a)}}};a=function(a,e,h,v){var x,k,t,p,r=[];k=typeof h;var I;v=v||a;if("undefined"===k||"function"===k){e=!e.length&&h.length?["require","exports","module"]:e;for(p=0;p<e.length;p+=1)if(t=m(e[p],v),k=t.f,"require"===k)r[p]=u.require(a);else if("exports"===k)r[p]=u.exports(a),I=!0;else if("module"===k)x=r[p]=u.module(a);
else if(q.call(w,k)||q.call(l,k)||q.call(n,k))r[p]=b(k);else if(t.p)t.p.load(t.n,f(v,!0),d(k),{}),r[p]=w[k];else throw Error(a+" missing "+k);e=h?h.apply(w[a],r):void 0;a&&(x&&x.exports!==g&&x.exports!==w[a]?w[a]=x.exports:e===g&&I||(w[a]=e))}else a&&(w[a]=h)};requirejs=require=h=function(n,q,v,x,d){if("string"===typeof n)return u[n]?u[n](q):b(m(n,q).f);if(!n.splice){e=n;e.deps&&h(e.deps,e.callback);if(!q)return;q.splice?(n=q,q=v,v=null):n=g}q=q||function(){};"function"===typeof v&&(v=x,x=d);x?a(g,
n,q,v):setTimeout(function(){a(g,n,q,v)},4);return h};h.config=function(a){return h(a)};requirejs._defined=w;define=function(a,e,n){if("string"!==typeof a)throw Error("See almond README: incorrect module build, no module name");e.splice||(n=e,e=[]);q.call(w,a)||q.call(l,a)||(l[a]=[a,e,n])};define.amd={jQuery:!0}})();define("../../lib/almond",function(){});
(function(g,k){"function"===typeof define&&define.amd?define("merge-xml",[],k):"object"===typeof exports?module.exports=k():g.MergeXML=k()})(this,function(){return function(g){var k,f,r,d,b,t,p,a,h,m=this;m.Init=function(){m.dom=null;m.nsp={};m.count=0;a[1]=!1;0<k&&(m.error={code:"",text:""});return 0<k};m.AddFile=function(a){return a&&a.target?a.target.result?m.AddSource(a.target.result):q("emf"):q("nof")};m.AddSource=function(v){var x;if("object"===typeof v)(x=m.Get(1,v)?v:!1)&&(1===k&&!window.DOMParser||
2===k&&!x.selectSingleNode("/"))&&(x=null);else try{x=u(v)}catch(b){x=!1}if(null===x)x=q("nos");else if(!1===x)x=q("inv");else if(!0===x)m.nsp=l(m.dom.documentElement),m.count=1,x=m.dom;else{var d=x;v=!0;if(d.inputEncoding!==m.dom.inputEncoding||d.xmlEncoding!==m.dom.xmlEncoding)v=q("enc");else if(d.documentElement.namespaceURI!==m.dom.documentElement.namespaceURI)v=q("nse");else if(d.documentElement.nodeName!==m.dom.documentElement.nodeName)if(!a[0])v=q("dif");else if(!a[1]){var f=u('<?xml version="'+
(m.dom.xmlVersion?m.dom.xmlVersion:"1.0")+'" encoding="'+(m.dom.inputEncoding?m.dom.inputEncoding:m.dom.xmlEncoding?m.dom.xmlEncoding:"utf-8")+'"?>\r\n<'+a[0]+">\r\n</"+a[0]+">");if(f){var p=m.dom.documentElement.cloneNode(!0);f.documentElement.appendChild(p);p=f.createTextNode("\r\n");f.documentElement.appendChild(p);m.dom=f;a[1]=!0}else v=q("jne"),a[1]=null}if(v){var d=l(d.documentElement),g;for(g in d)m.nsp[g]||(m.dom.documentElement.setAttribute("xmlns:"+g,d[g]),m.nsp[g]=d[g]);h?1===k?t=e:n():
t=null}v?(w(x,"/"),!0===a[1]&&(x=m.dom.createTextNode("\r\n"),m.dom.documentElement.appendChild(x)),m.count++,x=m.dom):x=!1}return x};var u=function(a){var e;1===k?m.dom?(e=r.parseFromString(a,"text/xml"),a=0===e.getElementsByTagNameNS(d,"parsererror").length?e:!1):(m.dom=r.parseFromString(a,"text/xml"),a=0===m.dom.getElementsByTagNameNS(d,"parsererror").length?!0:!1):m.dom?(e=new ActiveXObject(f),e.async=!1,a=e.loadXML(a)?e:!1):(m.dom=new ActiveXObject(f),m.dom.async=!1,m.dom.setProperty("SelectionLanguage",
"XPath"),a=m.dom.loadXML(a)?!0:!1);return a},w=function(a,e){for(var q=0;q<a.childNodes.length;q++){var b,d=a.childNodes[q],f;b=a.childNodes;f=d;var u=e,t=q,g=void 0,g=void 0,r=0;if(1===f.nodeType){for(g=0;g<=t;g++)(h&&b[g].nodeType===f.nodeType&&b[g].nodeName===f.nodeName||!h&&7!==b[g].nodeType)&&r++;if(h){b=!1;t=l(f);g=void 0;for(g in t)"_"!==g&&(m.nsp[g]=t[g],b=2===k);b&&n();g=f.prefix?f.prefix+":":m.nsp._?"_:":"";g+=f.localName?f.localName:f.baseName}else g="node()"}else if(3===f.nodeType||8===
f.nodeType){for(g=0;g<=t;g++)b[g].nodeType===f.nodeType&&r++;g=3===f.nodeType?"text()":"comment()"}else g=u;r&&(g=u+("/"===u.slice(-1)?"":"/")+g+"["+r+"]");f=g;u=m.Query(f);if(1===d.nodeType){r=!0;if(null===u||u.namespaceURI!==d.namespaceURI)b=d.cloneNode(!0),u=m.Query(e),u.appendChild(b);else{b=u.getAttribute("stay");t=!1;g=void 0;for(g in b)if(b[g]===p){t=g;break}!1!==t&&(r=!1);if(r)try{for(b=0;b<d.attributes.length;b++)u.setAttribute(d.attributes[b].nodeName,d.attributes[b].nodeValue)}catch(E){}}d.hasChildNodes()&&
r&&w(d,f)}else if(3===d.nodeType||8===d.nodeType)null===u||u.nodeType!==d.nodeType?(u=m.Query(e),b=3===d.nodeType?m.dom.createTextNode(d.nodeValue):m.dom.createComment(d.nodeValue),u.appendChild(b)):u.nodeValue=d.nodeValue}},l=function(a){var e={};a=a.attributes;for(var n=0;n<a.length;++n){var h=a[n].name.split(":");"xmlns"===h[0]&&(e[h[1]?h[1]:"_"]=a[n].value)}return e};m.Query=function(e){var n;a[1]&&(e="/"+m.dom.documentElement.nodeName+("/"===e?"":e));try{1===k?(n=b.evaluate(e,m.dom,t,XPathResult.FIRST_ORDERED_NODE_TYPE,
null),n=n.singleNodeValue):n=m.dom.selectSingleNode(e)}catch(h){n=null}return n};var e=function(a){return m.nsp[a]||null},n=function(){var a="",e;for(e in m.nsp)a+=" xmlns:"+e+"='"+m.nsp[e]+"'";a&&m.dom.setProperty("SelectionNamespaces",a.substr(1))};m.Get=function(e,n){var h;e&&!n&&(n=m.dom);if(e)if(n)if(n.xml)h=n.xml;else try{h=(new XMLSerializer).serializeToString(n)}catch(q){h=null}else h="";else h=m.dom;if(h&&2===e){if(a[1]){var b=h.indexOf("<"+a[0]);h=h.substr(0,b)+"\r\n"+h.substr(b)}h=h.replace(/</g,
"&lt;").replace(/>/g,"&gt;").replace(/ |\t/g,"&nbsp;");h=h.replace(/(\r\n|\n|\r)/g,"<br>")}return h};var q=function(a){var e={nod:"XML DOM is not supported in this browser",nox:"xPath is not supported in this browser",nos:"Incompatible source object",nof:"File not found",emf:"File is empty",inv:"Invalid XML source",enc:"Different encoding",dif:"Different root nodes",jne:"Invalid join parameter",nse:"Namespace incompatibility",und:"Undefined error"};m.error.code=e[a]?a:"und";m.error.text=e[m.error.code];
return!1};"object"!==typeof g&&(g={});p="undefined"===typeof g.stay?["all"]:g.stay?"object"===typeof g.stay&&g.stay instanceof Array?g.stay:[g.stay]:[];a="undefined"===typeof g.join?["root"]:[g.join?String(g.join):!1];h="undefined"===typeof g.updn?!0:g.updn;k=function(){var a;a=!1;for(var e=["MSXML2.DOMDocument.6.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","Microsoft.XmlDom"],n=e.length,h=0;h<n;h++)try{var q=new ActiveXObject(e[h]);q.async=!1;a=!0;if(q.loadXML("<x></x>")&&q.selectSingleNode("/"))break}catch(m){}a?
h<n?(f=e[h],a=2):a="nox":window.DOMParser?window.XPathEvaluator?(r=new DOMParser,d=r.parseFromString("Invalid","text/xml").getElementsByTagName("parsererror")[0].namespaceURI,b=new XPathEvaluator,a=1):a="nox":a="nod";return a}();"string"===typeof k&&(m.error={},q(k),k=0);m.Init()}});
define("enketo-js/utils",[],function(){return{parseFunctionFromExpression:function(g,k){var f,r,d,b=new RegExp(k+"\\s*\\(","g"),t=[];if(!g||!k)return t;for(;null!==(f=b.exec(g));){r=1;d=f.index;for(f=b.lastIndex;0!==r;)f++,"("===g[f]?r++:")"===g[f]&&r--;t.push([g.substring(d,f+1),g.substring(b.lastIndex,f).trim()])}return t}}});
var openrosa_xpath_extensions=function(){var g="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),k="Sun Mon Tue Wed Thu Fri Sat".split(" "),f=/^(-?[0-9]+)$/,r=/^\d\d\d\d-\d\d-\d\d(?:T\d\d:\d\d:\d\d(?:Z|[+-]\d\d:\d\d))?$/,d={boolean:function(a){return{t:"bool",v:a}},number:function(a){return{t:"num",v:a}},string:function(a){return{t:"str",v:a}},dateString:function(a){a=a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate());return d.string(a)}},b=function(a,b){b=b||2;for(a=a.toString();a.length<
b;)a="0"+a;return a},t=function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)},p=function(a,d){a=new Date(Date.parse(a));var f,t,l="",e=1900+a.getYear(),n=1+a.getMonth(),q=a.getDate(),v=a.getHours(),x=a.getMinutes(),O=a.getSeconds(),S=a.getTime(),p=a.getDay();for(t=0;t<d.length;++t)if(f=d.charAt(t),"%"===f){if(++t>=d.length)throw Error("date format string ends with %");f=d.charAt(t);if("%"===f)l+="%";else if("Y"===f)l+=b(e,4);else if("y"===f)l+=b(e,4).substring(2);else if("m"===
f)l+=b(n,2);else if("n"===f)l+=n;else if("b"===f)l+=g[n-1];else if("d"===f)l+=b(q,2);else if("e"===f)l+=q;else if("H"===f)l+=b(v,2);else if("h"===f)l+=v;else if("M"===f)l+=b(x,2);else if("S"===f)l+=b(O,2);else if("3"===f)l+=b(S,3);else if("a"===f)l+=k[p-1];else{if("Z"===f||"A"===f||"B"===f)throw Error("unsupported escape in date format string [%"+f+"]");throw Error("unrecognized escape in date format string [%"+f+"]");}}else l+=f;return l},a;a={"boolean-from-string":function(a){return d.boolean("1"===
a||"true"===a)},coalesce:function(a,b){return d.string(a||b)},date:function(a){if(f.test(a)){var b=new Date(0);b.setDate(1+parseInt(a,10));return d.dateString(b)}return r.test(a)?d.string(a.substring(0,10)):d.string("Invalid Date")},"decimal-date":function(a){return d.number(Date.parse(a)/864E5)},"false":function(){return d.boolean(!1)},"format-date":function(a,b){return d.string(p(a,b))},"if":function(a,b,f){return d.string(a?b:f)},int:function(a){return d.number(parseInt(a,10))},now:function(){return d.number(Date.now())},
pow:function(a,b){return d.number(Math.pow(a,b))},random:function(){return d.number(Math.random())},regex:function(a,b){return d.boolean((new RegExp(b)).test(a))},selected:function(a,b){debugger;return d.boolean(-1!==a.split(" ").indexOf(b))},substr:function(a,b,f){return d.string(a.slice(b,f))},today:function(){return d.dateString(new Date)},"true":function(){return d.boolean(!0)},uuid:function(){return d.string("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t))}};a["date-time"]=a.date;a["decimal-date-time"]=
a["decimal-date"];a["format-date-time"]=a["format-date"];return a}();"function"===typeof define?define("openrosa-xpath-extensions",[],function(){return openrosa_xpath_extensions}):"object"===typeof module&&"object"===typeof module.exports&&(module.exports=openrosa_xpath_extensions);
var ExtendedXpathEvaluator=function(g,k){var f=function(b){return b.resultType===XPathResult.NUMBER_TYPE?{t:"num",v:b.numberValue}:b.resultType===XPathResult.BOOLEAN_TYPE?{t:"bool",v:b.booleanValue}:{t:"str",v:b.stringValue}},r=function(b){return"num"===b.t?{resultType:XPathResult.NUMBER_TYPE,numberValue:b.v,stringValue:b.v.toString()}:"bool"===b.t?{resultType:XPathResult.BOOLEAN_TYPE,booleanValue:b.v,stringValue:b.v.toString()}:{resultType:XPathResult.STRING_TYPE,stringValue:b.v.toString()}},d=function(b,
d){if(k.hasOwnProperty(b)){var a=[],h;for(h=0;h<d.length;++h)a.push(d[h].v);return k[b].apply(null,a)}var a="",m,u;for(u=0;u<d.length;++u)h=d[u],"num"!==h.t&&"bool"!==h.t&&(m=-1===h.v.indexOf('"')?'"':"'",a+=m),a+=h.v,"bool"===h.t&&(a+="()"),"num"!==h.t&&"bool"!==h.t&&(a+=m),u<d.length-1&&(a+=", ");return f(g(b+"("+a+")"))},b=function(b){switch(typeof b){case "boolean":return"bool";case "number":return"num";default:return"str"}};this.evaluate=function(k){debugger;var p,a=[{t:"root",tokens:[]}],h=
function(){return a.slice(-1)[0]},m=function(e){throw Error((e||"")+" [stack="+JSON.stringify(a)+"] [cur="+JSON.stringify(p)+"]");},u=function(){p={t:"?",v:""}},w=function(){var a,e,n,d,f;n=h().tokens;e=n.length;3<=e&&(d=n[e-3],f=n[e-2],e=n[e-1],"+"===f.t?a=d.v+e.v:"-"===f.t?a=d.v-e.v:"*"===f.t?a=d.v*e.v:"/"===f.t?a=d.v/e.v:"%"===f.t?a=d.v%e.v:"="===f.t?a=d.v===e.v:"<"===f.t?a=d.v<e.v:">"===f.t?a=d.v>e.v:"<="===f.t?a=d.v<=e.v:">="===f.t?a=d.v>=e.v:"!="===f.t&&(a=d.v!=e.v),"undefined"!==typeof a&&
(n=n.slice(0,-3),n.push({t:b(a),v:a}),h().tokens=n))},l=function(){var a;a=p.v.trim();a=/^-?[0-9]+(\.[0-9]+)?$/.test(a)?{t:"num",v:parseFloat(a)}:f(g(p.v));h().tokens.push(a);u();w()},e=function(){if(i<k.length-1)return k.charAt(i+1)};u();for(i=0;i<k.length;++i)if(c=k.charAt(i),"str"===p.t)c===p.quote?(h().tokens.push(p),w(),u()):p.v+=c;else switch(c){case "'":case '"':"?"===p.t&&""===p.v?p={t:"str",quote:c,v:""}:m("Not sure how to handle: "+c);break;case "(":"?"===p.t&&""!==p.v?(p.t="fn",p.tokens=
[],a.push(p),u()):m();break;case ")":if("?"===p.t){""!==p.v&&l();var n=a.pop();"fn"!==n.t&&m();h().tokens.push(d(n.v,n.tokens));w();u()}else m();break;case ",":"?"===p.t?(""!==p.v&&l(),"fn"!==h().t&&m()):m();break;case "-":if(!(n=/[0-9]/.test(e()))&&(n=" "!==e())&&(n=0<i?k.charAt(i-1):void 0,n=" "!==n),n){p.v+=c;break}case "=":if("="===c&&("<"===p.v||"&lt;"===p.v||">"===p.v||"&gt;"===p.v||"!"===p.v)){p.v+=c;break}case ">":case "<":if(("<"===c||">"===c)&&"="===e()){p.v+=c;break}case "+":case "*":"?"===
p.t?(""!==p.v&&l(),h().tokens.push({t:c})):m();break;case " ":if("?"===p.t){""!==p.v&&("mod"===p.v?(h().tokens.push({t:"%"}),u()):"div"===p.v?(h().tokens.push({t:"/"}),u()):"&lt;"===p.v?(h().tokens.push({t:"<"}),u()):"&gt;"===p.v?(h().tokens.push({t:">"}),u()):"<="===p.v||"&lt;="===p.v?(h().tokens.push({t:"<="}),u()):">="===p.v||"&gt;="===p.v?(h().tokens.push({t:">="}),u()):"!="===p.v?(h().tokens.push({t:"!="}),u()):l());break}default:p.v+=c}"?"===p.t&&""!==p.v&&l();("?"!==p.t||""!==p.v||p.tokens&&
current.tokens.length)&&m("Current item not evaluated!");1<a.length&&m("Stuff left on stack.");"root"!==a[0].t&&m("Weird stuff on stack.");0===a[0].tokens.length&&m("No tokens.");1<a[0].tokens.length&&m("Too many tokens.");return r(a[0].tokens[0])}};"function"===typeof define?define("extended-xpath",[],function(){return ExtendedXpathEvaluator}):"object"===typeof module&&"object"===typeof module.exports&&(module.exports=ExtendedXpathEvaluator);
define("enketo-js/plugins",["jquery"],function(g){g.fn.clearInputs=function(k){k=k||"edit";return this.each(function(){g(this).find(".file-preview").remove();g(this).find("input, select, textarea").not(".ignore").each(function(){var f=g(this),r=f.attr("type");"SELECT"===f.prop("nodeName").toUpperCase()&&(r="select");"TEXTAREA"===f.prop("nodeName").toUpperCase()&&(r="textarea");switch(r){case "date":case "datetime":case "time":case "number":case "search":case "color":case "range":case "url":case "email":case "password":case "text":case "file":f.removeAttr("data-previous-file-name data-loaded-file-name");
case "hidden":case "textarea":""!==f.val()&&f.val("").trigger(k);break;case "radio":case "checkbox":f.prop("checked")&&(f.prop("checked",!1),f.trigger(k));break;case "select":0<=f[0].selectedIndex&&(f[0].selectedIndex=-1,f.trigger(k));break;default:console.error("Unrecognized input type found when trying to reset",this)}})})};g.fn.markdownToHtml=function(){return this.each(function(){var k,f=g("<div/>");g(this).children(":not(input, select, textarea)").each(function(k){k="$$$"+k;g(this).clone().markdownToHtml().appendTo(f);
g(this).replaceWith(k)});k=g(this).html();k=k.replace(/__([^\s][^_]*[^\s])__/gm,"<strong>$1</strong>");k=k.replace(/\*\*([^\s][^\*]*[^\s])\*\*/gm,"<strong>$1</strong>");k=k.replace(/_([^\s][^_]*[^\s])_/gm,"<em>$1</em>");k=k.replace(/\*([^\s][^\*]*[^\s])\*/gm,"<em>$1</em>");k=k.replace(/\[([^\]]*)\]\(([^\)]+)\)/gm,'<a href="$2" target="_blank">$1</a>');k=k.replace(/\n/gm,"<br />");f.children().each(function(f){k=k.replace(new RegExp("\\$\\$\\$"+f),g(this)[0].outerHTML)});g(this).text("").append(k)})};
g.fn.reverse=[].reverse});define("enketo-js/extend",["require"],function(g){String.prototype.pad=function(k){for(var f=this;f.length<k;)f="0"+f;return f};Date.prototype.toISOLocalString=function(){var k,f,g,d;d=function(b){return 10>b?"0"+b:b};if("Invalid Date"===this.toString())return this.toString();k=this.getTimezoneOffset();f=0>k?"+":"-";g=d(Math.abs(Math.floor(k/60)));d=d(Math.abs(Math.floor(k%60)));return(new Date(this.getTime()-6E4*k)).toISOString().replace("Z",f+g+":"+d)}});
(function(g){"function"===typeof define&&define.amd?define("jquery.xpath",["jquery"],g):g(jQuery)})(function(g){g.fn.getXPath=function(k,f){var g,d=[];g="";var b=this.first(),t=b.prop("nodeName"),p=b.parent(),a=p.prop("nodeName");k=k||"#document";if(f=f||!1)g=b.siblings(t).addBack(),g=1<g.length?"["+(g.index(b)+1)+"]":"";for(d.push(t+g);1==p.length&&a!==k&&"#document"!==a;)f&&(g=p.siblings(a).addBack(),g=1<g.length?"["+(g.index(p)+1)+"]":""),d.push(a+g),p=p.parent(),a=p.prop("nodeName");return"/"+
d.reverse().join("/")};g.fn.xfind=function(g){var f,r;g=g.replace(/\/\//g," ");g=g.replace(/^\//,"");g=g.replace(/\/\.$/,"");g=g.replace(/\//g,">");g=g.replace(/\[([^@].*?)\]/g,function(d,b){return":has("+b+")"});if(0<=g.indexOf(">..")){g=g.split(/>\.\.>?/g);f=jQuery(g[0],this);for(r=1;r<g.length;r++)f=f.parent(g[r]);return f.get()}g=g.replace(/\./gi,"\\.");return this.find(g)}});
define("enketo-js/FormModel","merge-xml enketo-js/utils jquery openrosa-xpath-extensions extended-xpath enketo-js/plugins enketo-js/extend jquery.xpath".split(" "),function(g,k,f,r,d){var b,t,p;b=function(a,b){"string"===typeof a&&(a={modelStr:a});a.external=a.external||[];a.submitted="undefined"!==typeof a.submitted?a.submitted:!0;b=b||{};b.full="undefined"!==typeof b.full?b.full:!0;this.convertedExpressions={};this.templates={};this.loadErrors=[];this.INSTANCE=/instance\([\'|\"]([^\/:\s]+)[\'|\"]\)/g;
this.OPENROSA=/(decimal-date-time\(|pow\(|indexed-repeat\(|format-date\(|coalesce\(|join\(|max\(|min\(|random\(|substr\(|int\(|uuid\(|regex\(|now\(|today\(|date\(|if\(|boolean-from-string\(|checklist\(|selected\(|selected-at\(|round\(|area\(|position\([^\)])/;this.data=a;this.options=b};b.prototype.init=function(){var a,b,d,g=this;this.data.modelStr=this.data.modelStr.replace(/\s(xmlns\=("|')[^\s\>]+("|'))/g," data-$1");this.options.full||(this.data.modelStr=this.data.modelStr.replace(/^(<model\s*><instance((?!<instance).)+<\/instance\s*>\s*)(<instance.+<\/instance\s*>)*/,
"$1"));try{a="model",this.xml=f.parseXML(this.data.modelStr),this.data.external.forEach(function(e){a='instance "'+e.id+'"'||"instance unknown";b=g.xml.getElementById(e.id);(d=b.querySelector("root"))&&b.removeChild(d);b.appendChild(f.parseXML(e.xmlStr).firstChild)})}catch(k){console.error(k),this.loadErrors.push("Error trying to parse XML "+a+". "+k.message)}if(this.xml){this.$=f(this.xml);this.hasInstance=!!this.xml.querySelector("model > instance")||!1;this.rootElement=this.xml.querySelector("instance > *")||
this.xml.documentElement;this.$.find("model > instance[src]:empty").each(function(a,n){g.loadErrors.push('External instance "'+f(n).attr("id")+'" is empty.')});this.trimValues();this.cloneAllTemplates();this.extractTemplates();try{a="record",this.data.instanceStr&&(this.mergeXml(this.data.instanceStr),this.data.submitted&&this.deprecateId())}catch(l){console.error(l),this.loadErrors.push("Error trying to parse XML "+a+". "+l.message)}}return this.loadErrors};b.prototype.node=function(a,b,d){return new t(a,
b,d,this)};b.prototype.mergeXml=function(a){var b,d,f,k;if(a){f=this.xml.querySelector("instance");k=this.xml.querySelector("instance > *");if(!k)throw Error("Model is corrupt. It does not contain a childnode of instance");d=new g({join:!1});b=(new XMLSerializer).serializeToString(k);d.AddSource(b);d.AddSource(a);if(d.error.code)throw Error(d.error.text);this.xml.querySelector("instance").removeChild(k);k=this.xml.adoptNode(d.Get(0).documentElement,!0);f.appendChild(k);this.rootElement=k}};b.prototype.trimValues=
function(){this.node(null,null,{noEmpty:!0}).get().each(function(){this.textContent=this.textContent.trim()})};b.prototype.deprecateId=function(){var a,b,d;a=this.xml.querySelectorAll("* > meta > instanceID");if(1!==a.length)throw Error("Invalid primary instance. Found "+a.length+" instanceID nodes but expected 1.");a=a[0];b=this.xml.querySelectorAll("* > meta > deprecatedID");if(1<b.length)throw Error("Invalid primary instance. Found "+b.length+" deprecatedID nodes but expected 1.");b=b[0];b||(b=
f.parseXML("<deprecatedID/>").documentElement,this.xml.adoptNode(b),d=this.xml.querySelector("* > meta"),d.appendChild(b));b.textContent=a.textContent;a.textContent=""};b.prototype.bindJsEvaluator=function(){var a=new XPathEvaluator;this.xml.jsCreateExpression=function(){return a.createExpression.apply(a,arguments)};this.xml.jsCreateNSResolver=function(){return a.createNSResolver.apply(a,arguments)};console.log("Certainly not the eggman.");this.xml.jsEvaluate=function(a,b,f,g,l){console.log("Calling custom evaluator for: "+
a);a=(new d(function(a){var n=b.ownerDocument;return n.evaluate.call(n,a,b,f,XPathResult.STRING_TYPE,l)},r)).evaluate(a);console.log("    -> "+a);return a};window.JsXPathException=window.JsXPathExpression=window.JsXPathNSResolver=window.JsXPathResult=window.JsXPathNamespace=!0};b.prototype.getInstanceID=function(){return this.node("/*/meta/instanceID").getVal()[0]};b.prototype.getInstanceName=function(){return this.node("/*/meta/instanceName").getVal()[0]};b.prototype.cloneRepeat=function(a,b){var d,
g,k,l=this.templates[a]||this.node(a,0).get();g=l.prop("nodeName");d=this.node(a,b).get();l[0]&&1===d.length&&0===d.nextAll(g).length?(d=l.clone().insertAfter(d),k=[l.prop("nodeName")],l.find("*").each(function(){k.push(f(this).prop("nodeName"))}),this.$.trigger("dataupdate",{nodes:k,repeatPath:a,repeatIndex:this.node(a,b).determineIndex(d)})):0===d.nextAll(g).length&&console.error("Could not find template node and/or node to insert the clone after")};b.prototype.extractTemplates=function(){var a=
this;this.evaluate("/model/instance[1]/*//*[@template] | /model/instance[1]/*//*[@jr:template]","nodes",null,null,!0).reverse().forEach(function(b){b=f(b);a.templates[b.getXPath("instance")]=b.removeAttr("template").removeAttr("jr:template").remove()})};b.prototype.getTemplatePath=function(a){var b,d=this;a.split("/").some(function(a,f,g){b=g.slice(0,g.length-f).join("/");return d.templates[b]});return b||void 0};b.prototype.cloneAllTemplates=function(){var a=this;this.evaluate("/model/instance[1]/*//*[@template] | /model/instance[1]/*//*[@jr:template]",
"nodes",null,null,!0).forEach(function(b){var d=b.nodeName,g=f(b).getXPath("instance");0===a.evaluate("ancestor::"+d+"[@template] | ancestor::"+d+"[@jr:template]","nodes",g,0,!0).length&&0===f(b).siblings(d).length&&f(b).clone().insertAfter(f(b)).find("*").addBack().removeAttr("template").removeAttr("jr:template")})};b.prototype.get=function(){return this.$||null};b.prototype.getXML=function(){return this.xml||null};b.prototype.getStr=function(){var a=(new XMLSerializer).serializeToString(this.xml.querySelector("instance > *")||
this.xml.documentElement,"text/xml"),a=a.replace(/\t/g,"");return a=a.replace(/\s(data-)(xmlns\=("|')[^\s\>]+("|'))/g," $2")};b.prototype.makeBugCompliant=function(a,b,d){var f,g,l;b=this.node(b,d).get();d=b.parents().add(b);for(b=d.length-1;0<=b;b--)g=d.eq(b),f=g.prop("nodeName").replace(/\./g,"\\."),l=g.siblings(f).not("[template]"),"instance"!==f.toLowerCase()&&"model"!==f.toLowerCase()&&0<l.length&&(f=g.getXPath("instance"),g=l.add(g).index(g),a=a.replace(new RegExp(f,"g"),f+"["+(g+1)+"]"));return a};
b.prototype.nsResolver={lookupNamespaceURI:function(a){return{jr:"http://openrosa.org/javarosa",xsd:"http://www.w3.org/2001/XMLSchema",orx:"http://openrosa.org/xforms/",cc:"http://commcarehq.org/xforms"}[a]||null}};b.prototype.shiftRoot=function(a){this.hasInstance&&(a=a.replace(/^(\/(?!model\/)[^\/][^\/\s]*\/)/g,"/model/instance[1]$1"),a=a.replace(/([^a-zA-Z0-9\.\]\)\/\*_-])(\/(?!model\/)[^\/][^\/\s]*\/)/g,"$1/model/instance[1]$2"));return a};b.prototype.replaceInstanceFn=function(a){return a.replace(this.INSTANCE,
function(a,b){return'/model/instance[@id="'+b+'"]'})};b.prototype.replaceCurrentFn=function(a){a=a.replace(/current\(\)\/\./g,".");return a=a.replace(/current\(\)/g,"")};b.prototype.replaceIndexedRepeatFn=function(a,b,d){var f=this,g=k.parseFunctionFromExpression(a,"indexed-repeat");if(!g.length)return a;g.forEach(function(g){var e,n,q,v=g[1].split(",");if(1===v.length%2){v=v.map(function(a){return a.trim()});n=v[0];for(e=v.length-1;1<e;e-=2)q=isNaN(v[e])?f.evaluate(v[e],"number",b,d,!0):v[e],n=n.replace(v[e-
1],v[e-1]+"[position() = "+q+"]");a=a.replace(g[0],n)}else return console.error("indexed repeat with incorrect number of parameters found",g[0]),'"Error with indexed-repeat parameters"'});return a};b.prototype.evaluate=function(a,b,d,g,k){var l,e,n,q,v,x,O;k=k||!1;b=b||"any";g=g||0;n=this.xml;x=null;d?(e=this.node(d).get(),x=e.length,e=e.eq(g)[0]):e=this.rootElement;O=[a,d,g,x].join("|");this.convertedExpressions[O]?a=this.convertedExpressions[O]:(a=a.trim(),a=this.shiftRoot(a),a=this.replaceInstanceFn(a),
a=this.replaceCurrentFn(a),a=this.replaceIndexedRepeatFn(a,d,g),x&&1<x&&(a=this.makeBugCompliant(a,d,g)),a=a.replace(/&lt;/g,"<"),a=a.replace(/&gt;/g,">"),a=a.replace(/&quot;/g,'"'),this.convertedExpressions[O]=a);d={0:["any","ANY_TYPE"],1:["number","NUMBER_TYPE","numberValue"],2:["string","STRING_TYPE","stringValue"],3:["boolean","BOOLEAN_TYPE","booleanValue"],7:["nodes","ORDERED_NODE_SNAPSHOT_TYPE"],9:["node","FIRST_ORDERED_NODE_TYPE","singleNodeValue"]};for(q in d)if(d.hasOwnProperty(q))if(q=Number(q),
d[q][0]===b)break;else q=0;if(k&&"undefined"!==typeof n.evaluate&&!this.OPENROSA.test(a))try{l=n.evaluate(a,e,this.nsResolver,q,null)}catch(t){console.log("%cWell native XPath evaluation did not work... No worries, worth a shot, the expression probably contained unknown OpenRosa functions or errors:","color:orange",a)}if(!l)try{"undefined"===typeof n.jsEvaluate&&this.bindJsEvaluator(),l=n.jsEvaluate(a,e,this.nsResolver,q,null)}catch(p){return l="Error occurred trying to evaluate: "+a+", message: "+
p.message,console.error(l),f(document).trigger("xpatherror",l),this.loadErrors.push(l),null}if(l){if(0===q){for(q in d)if(d.hasOwnProperty(q)&&(q=Number(q),q===Number(l.resultType)&&0<q&&4>q)){v=l[d[q][2]];break}console.error("Expression: "+a+" did not return any boolean, string or number value as expected")}else if(7===q)for(v=[],a=0;a<l.snapshotLength;a++)v.push(l.snapshotItem(a));else v=l[d[q][2]];return v}};t=function(a,b,d,f){var g=f.hasInstance?"/model/instance[1]//*":"//*";this.model=f;this.originalSelector=
a;this.selector="string"===typeof a&&0<a.length?a:g;this.filter=d="undefined"!==typeof d&&null!==d?d:{};this.filter.onlyLeaf="undefined"!==typeof d.onlyLeaf?d.onlyLeaf:!1;this.filter.noEmpty="undefined"!==typeof d.noEmpty?d.noEmpty:!1;this.index=b};t.prototype.get=function(){var a,b;this.nodes||(this.nodes=this.model.evaluate(this.selector,"nodes",null,null,!0));a=!0===this.filter.noEmpty?f(this.nodes).filter(function(){var a=f(this);b=a.text();return 0===a.children().length&&0<b.trim().length}):
!0===this.filter.onlyLeaf?f(this.nodes).filter(function(){return 0===f(this).children().length}):f(this.nodes);return"undefined"!==typeof this.index&&null!==this.index?a.eq(this.index):a};t.prototype.setIndex=function(a){this.index=a};t.prototype.setVal=function(a,b,d){var g,k;g=this.getVal()[0];k="undefined"!==typeof a&&null!==a?f.isArray(a)?a.join(" "):a.toString():"";k=this.convert(k,d);a=this.get();if(1===a.length&&f.trim(k.toString())!==f.trim(g.toString()))return a.text(k),b=this.validate(b,
d),g=this.getClosestRepeat(),g.nodes=[a.prop("nodeName")],this.model.$.trigger("dataupdate",g),"binary"===d&&(0<k.length?a.attr("type","file"):a.removeAttr("type")),b;if(1<a.length)return console.error("nodeset.setVal expected nodeset with one node, but received multiple"),null;0===a.length&&console.error("Data node: "+this.selector+" with null-based index: "+this.index+" not found. Ignored.");return null};t.prototype.getVal=function(){var a=[];this.get().each(function(){a.push(f(this).text())});
return a};t.prototype.determineIndex=function(a){var b,d;a=a||this.get();if(1===a.length)return b=a.prop("nodeName"),d=a.getXPath("instance"),b=this.model.$.find(b).filter(function(){return d===f(this).getXPath("instance")}),1===b.length?null:b.index(a);console.error("no node, or multiple nodes, provided to nodeset.determineIndex");return-1};t.prototype.getClosestRepeat=function(){for(var a=this.get(),b=a.prop("nodeName");0===a.siblings(b).length&&"instance"!==b;)a=a.parent(),b=a.prop("nodeName");
return"instance"===b?{}:{repeatPath:a.getXPath("instance"),repeatIndex:this.determineIndex(a)}};t.prototype.remove=function(){var a,b,d,g,k;a=this.get();0<a.length?(b=[a.prop("nodeName")],a.find("*").each(function(){d=f(this);b.push(d.prop("nodeName"))}),g=a.getXPath("instance"),k=this.determineIndex(a),a.remove(),this.nodes=null,this.model.$.trigger("dataupdate",{updatedNodes:b,repeatPath:g,repeatIndex:k})):console.error("could not find node "+this.selector+" with index "+this.index+" to remove ")};
t.prototype.convert=function(a,b){return""===a.toString()?a:"undefined"!==typeof b&&null!==b&&"undefined"!==typeof p[b.toLowerCase()]&&"undefined"!==typeof p[b.toLowerCase()].convert?p[b.toLowerCase()].convert(a):a};t.prototype.validate=function(a,b){var d,f;b&&"undefined"!==typeof p[b.toLowerCase()]||(b="string");if(!a&&("string"===b||"select"===b||"select1"===b||"binary"===b))return!0;d=this.getVal()[0];if(""===d.toString())return!0;d=p[b.toLowerCase()].validate(d);f="undefined"!==typeof a&&null!==
a&&0<a.length?this.model.evaluate(a,"boolean",this.originalSelector,this.index):!0;return d&&f};p={string:{validate:function(){return!0}},select:{validate:function(){return!0}},select1:{validate:function(){return!0}},decimal:{validate:function(a){return isNaN(a-0)||null===a?!1:!0},convert:function(a){return"NaN"===a?"":a}},"int":{validate:function(a){return isNaN(a-0)||null===a||Math.round(a).toString()!==a.toString()?!1:!0},convert:function(a){return"NaN"===a?"":a}},date:{validate:function(a){return(a=
/([0-9]{4})([\-]|[\/])([0-9]{2})([\-]|[\/])([0-9]{2})/.exec(a))&&6===a.length?"Invalid Date"!==(new Date(Number(a[1]),Number(a[3])-1,Number(a[5]))).toString():!1},convert:function(a){var b=/([0-9]{4})([\-]|[\/])([0-9]{2})([\-]|[\/])([0-9]{2})/.exec(a),d=new Date(a);"Invalid Date"===(new Date(a)).toString()&&b&&0<Number(b[1])&&0<=Number(b[3])&&12>Number(b[3])&&32>Number(b[5])&&(d=new Date(Number(b[1]),Number(b[3])-1,Number(b[5])));return d.getUTCFullYear().toString().pad(4)+"-"+(d.getUTCMonth()+1).toString().pad(2)+
"-"+d.getUTCDate().toString().pad(2)}},datetime:{validate:function(a){return"Invalid Date"!==(new Date(a.toString())).toString()||"Invalid Date"!==(new Date(this.convert(a.toString()))).toString()},convert:function(a){var b=/([0-9]{4}\-[0-9]{2}\-[0-9]{2})([T]|[\s])([0-9]){2}:([0-9]){2}([0-9:.]*)(\+|\-)([0-9]{2}):([0-9]{2})$/,d=/([0-9]{4}\-[0-9]{2}\-[0-9]{2})([T]|[\s])([0-9]){2}:([0-9]){2}([0-9:.]*)(\+|\-)([0-9]{2})$/;if("Invalid Date"!==(new Date(a)).toString()&&b.test(a))return a;if("Invalid Date"===
(new Date(a)).toString()&&d.test(a))return a+":00";a=new Date(a);return"Invalid Date"!==a.toString()?a.toISOLocalString():a.toString()}},time:{validate:function(a){var b=new Date;a=a.toString().split(":");if(2>a.length)return!1;a[2]=a[2]?Number(a[2].toString().split(".")[0]):0;return 24>a[0]&&0<=a[0]&&60>a[1]&&0<=a[1]&&60>a[2]&&0<=a[2]&&"Invalid Date"!==b.toString()},convert:function(a){var b=a.toString().split(":");f.each(b,function(a,d){b[a]=d.toString().pad(2)});return b.join(":")}},barcode:{validate:function(){return!0}},
geopoint:{validate:function(a){a=a.toString().trim().split(" ");return""!==a[0]&&-90<=a[0]&&90>=a[0]&&""!==a[1]&&-180<=a[1]&&180>=a[1]&&("undefined"===typeof a[2]||!isNaN(a[2]))&&("undefined"===typeof a[3]||!isNaN(a[3])&&0<=a[3])},convert:function(a){return f.trim(a.toString())}},geotrace:{validate:function(a){a=a.toString().split(";");return 2<=a.length&&a.every(function(a){return p.geopoint.validate(a)})},convert:function(a){return a.toString().trim()}},geoshape:{validate:function(a){console.debug("validating geoshape, this: ",
this);a=a.toString().split(";");return 4<=a.length&&a[0]===a[a.length-1]&&a.every(function(a){return p.geopoint.validate(a)})},convert:function(a){return a.toString().trim()}},binary:{validate:function(){return!0}}};return b});
define("text",["module"],function(g){var k,f,r,d,b,t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],p=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,h="undefined"!==typeof location&&location.href,m=h&&location.protocol&&location.protocol.replace(/\:/,""),u=h&&location.hostname,w=h&&(location.port||void 0),l={},e=g.config&&g.config()||{};k={version:"2.0.10",strip:function(e){if(e){e=e.replace(p,"");var b=e.match(a);b&&(e=b[1])}else e=
"";return e},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:e.createXhr||function(){var a,e,b;if("undefined"!==typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!==typeof ActiveXObject)for(e=0;3>e;e+=1){b=t[e];try{a=new ActiveXObject(b)}catch(d){}if(a){t=[b];break}}return a},parseName:function(a){var e,
b,d=!1,f=a.indexOf(".");e=0===a.indexOf("./")||0===a.indexOf("../");-1!==f&&(!e||1<f)?(e=a.substring(0,f),b=a.substring(f+1,a.length)):e=a;a=b||e;f=a.indexOf("!");-1!==f&&(d="strip"===a.substring(f+1),a=a.substring(0,f),b?b=a:e=a);return{moduleName:e,ext:b,strip:d}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,e,b,d){var f,g;f=k.xdRegExp.exec(a);if(!f)return!0;a=f[2];f=f[3];f=f.split(":");g=f[1];f=f[0];return(!a||a===e)&&(!f||f.toLowerCase()===b.toLowerCase())&&(!g&&!f||g===d)},finishLoad:function(a,
b,d,f){d=b?k.strip(d):d;e.isBuild&&(l[a]=d);f(d)},load:function(a,b,d,f){if(f.isBuild&&!f.inlineText)d();else{e.isBuild=f.isBuild;var g=k.parseName(a);f=g.moduleName+(g.ext?"."+g.ext:"");var l=b.toUrl(f),t=e.useXhr||k.useXhr;0===l.indexOf("empty:")?d():!h||t(l,m,u,w)?k.get(l,function(e){k.finishLoad(a,g.strip,e,d)},function(a){d.error&&d.error(a)}):b([f],function(a){k.finishLoad(g.moduleName+"."+g.ext,g.strip,a,d)})}},write:function(a,e,b,d){l.hasOwnProperty(e)&&(d=k.jsEscape(l[e]),b.asModule(a+"!"+
e,"define(function () { return '"+d+"';});\n"))},writeFile:function(a,e,b,d,f){e=k.parseName(e);var g=e.ext?"."+e.ext:"",h=e.moduleName+g,l=b.toUrl(e.moduleName+g)+".js";k.load(h,b,function(e){e=function(a){return d(l,a)};e.asModule=function(a,e){return d.asModule(a,l,e)};k.write(a,h,e,f)},f)}};if("node"===e.env||!e.env&&"undefined"!==typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"])f=require.nodeRequire("fs"),k.get=function(a,e,b){try{var d=f.readFileSync(a,
"utf8");0===d.indexOf("\ufeff")&&(d=d.substring(1));e(d)}catch(g){b(g)}};else if("xhr"===e.env||!e.env&&k.createXhr())k.get=function(a,b,d,f){var g=k.createXhr(),h;g.open("GET",a,!0);if(f)for(h in f)f.hasOwnProperty(h)&&g.setRequestHeader(h.toLowerCase(),f[h]);if(e.onXhr)e.onXhr(g,a);g.onreadystatechange=function(f){if(4===g.readyState&&(f=g.status,399<f&&600>f?(f=Error(a+" HTTP status: "+f),f.xhr=g,d(f)):b(g.responseText),e.onXhrComplete))e.onXhrComplete(g,a)};g.send(null)};else if("rhino"===e.env||
!e.env&&"undefined"!==typeof Packages&&"undefined"!==typeof java)k.get=function(a,e){var b,d,f=new java.io.File(a),g=java.lang.System.getProperty("line.separator"),f=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(f),"utf-8")),h="";try{b=new java.lang.StringBuffer;(d=f.readLine())&&d.length()&&65279===d.charAt(0)&&(d=d.substring(1));for(null!==d&&b.append(d);null!==(d=f.readLine());)b.append(g),b.append(d);h=String(b.toString())}finally{f.close()}e(h)};else if("xpconnect"===
e.env||!e.env&&"undefined"!==typeof Components&&Components.classes&&Components.interfaces)r=Components.classes,d=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),b="@mozilla.org/windows-registry-key;1"in r,k.get=function(a,e){var f,g,h,k={};b&&(a=a.replace(/\//g,"\\"));h=new FileUtils.File(a);try{f=r["@mozilla.org/network/file-input-stream;1"].createInstance(d.nsIFileInputStream),f.init(h,1,0,!1),g=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(d.nsIConverterInputStream),
g.init(f,"utf-8",f.available(),d.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),g.readString(f.available(),k),g.close(),f.close(),e(k.value)}catch(l){throw Error((h&&h.path||"")+": "+l);}};return k});define("text!enketo-config",[],function(){return'{\n    "widgets": [\n        "enketo-widget/note/notewidget",\n        "enketo-widget/select-desktop/selectpicker",\n        "enketo-widget/select-mobile/selectpicker",\n        "enketo-widget/geo/geopicker",\n        "enketo-widget/table/tablewidget",\n        "enketo-widget/radio/radiopicker",\n        "enketo-widget/date/datepicker-extended",\n        "enketo-widget/time/timepicker-extended",\n        "enketo-widget/datetime/datetimepicker-extended",\n        "enketo-widget/mediagrid/mediagridpicker",\n        "enketo-widget/file/filepicker",\n        "enketo-widget/select-likert/likertitem",\n        "enketo-widget/distress/distresspicker",\n        "enketo-widget/horizontal-choices/horizontalchoices"\n    ],\n    "maps": [ {\n        "tiles": [ "http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png" ],\n        "name": "streets",\n        "attribution": "Map data \u00a9 <a href=\\"http://openstreetmap.org\\">OpenStreetMap</a> contributors"\n    }, {\n        "tiles": "GOOGLE_SATELLITE",\n        "name": "satellite"\n    } ],\n    "googleApiKey": ""\n}\n'});
define("enketo-js/support",[],function(){var g={inputtypes:{}};["date","datetime","time"].forEach(function(k){var f=document.createElement("input");f.setAttribute("type",k);g.inputtypes[k]="text"!==f.type});"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?(g.touch=!0,document.documentElement.classList+=" touch"):g.touch=!1;return g});
(function(g){"function"===typeof bootstrap?bootstrap("promise",g):"object"===typeof exports?module.exports=g():"function"===typeof define&&define.amd?define("q",g):"undefined"!==typeof ses?ses.ok()&&(ses.makeQ=g):Q=g()})(function(){function g(a){return function(){return I.apply(a,arguments)}}function k(a,e){if(T&&e.stack&&"object"===typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf("From previous event:")){for(var b=[],d=e;d;d=d.source)d.stack&&b.unshift(d.stack);b.unshift(a.stack);for(var b=b.join("\nFrom previous event:\n").split("\n"),
d=[],n=0;n<b.length;++n){var g=b[n],q;if(q=f(g)){var h=q[1];q=q[0]===K&&h>=U&&h<=V}else q=!1;q||(q=g,q=-1!==q.indexOf("(module.js:")||-1!==q.indexOf("(node.js:"));q||!g||d.push(g)}b=d.join("\n");a.stack=b}}function f(a){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(e||(e=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a)))return[e[1],Number(e[2])];if(a=/.*@(.+):(\d+)$/.exec(a))return[a[1],Number(a[2])]}function r(){if(T)try{throw Error();}catch(a){var e=a.stack.split("\n"),e=0<e[0].indexOf("@")?e[1]:e[2];if(e=
f(e))return K=e[0],e[1]}}function d(a){return u(a)?a:w(a)?v(a):q(a)}function b(){function e(a){h=a;l.source=a;F(f,function(e,b){E(function(){a.promiseDispatch.apply(a,b)})},void 0);g=f=void 0}var f=[],g=[],h,k=X(b.prototype),l=X(a.prototype);l.promiseDispatch=function(a,e,b){var d=z(arguments);f?(f.push(d),"when"===e&&b[1]&&g.push(b[1])):E(function(){h.promiseDispatch.apply(h,d)})};l.valueOf=function(){if(f)return l;var a=m(h);u(a)&&(h=a);return a};l.inspect=function(){return h?h.inspect():{state:"pending"}};
if(d.longStackSupport&&T)try{throw Error();}catch(v){l.stack=v.stack.substring(v.stack.indexOf("\n")+1)}k.promise=l;k.resolve=function(a){h||e(d(a))};k.fulfill=function(a){h||e(q(a))};k.reject=function(a){h||e(n(a))};k.notify=function(a){h||F(g,function(e,b){E(function(){b(a)})},void 0)};return k}function t(a){if("function"!==typeof a)throw new TypeError("resolver must be a function.");var e=b();try{a(e.resolve,e.reject,e.notify)}catch(d){e.reject(d)}return e.promise}function p(a){return t(function(e,
b){for(var f=0,n=a.length;f<n;f++)d(a[f]).then(e,b)})}function a(e,b,d){void 0===b&&(b=function(a){return n(Error("Promise does not support operation: "+a))});void 0===d&&(d=function(){return{state:"unknown"}});var f=X(a.prototype);f.promiseDispatch=function(a,d,g){var q;try{q=e[d]?e[d].apply(f,g):b.call(f,d,g)}catch(h){q=n(h)}a&&a(q)};if(f.inspect=d){var g=d();"rejected"===g.state&&(f.exception=g.reason);f.valueOf=function(){var a=d();return"pending"===a.state||"rejected"===a.state?f:a.value}}return f}
function h(a,e,b,f){return d(a).then(e,b,f)}function m(a){if(u(a)){var e=a.inspect();if("fulfilled"===e.state)return e.value}return a}function u(a){return a===Object(a)&&"function"===typeof a.promiseDispatch&&"function"===typeof a.inspect}function w(a){return a===Object(a)&&"function"===typeof a.then}function l(){N.length=0;R.length=0;J||(J=!0)}function e(a,e){J&&(R.push(a),e&&"undefined"!==typeof e.stack?N.push(e.stack):N.push("(no stack) "+e))}function n(b){var d=a({when:function(a){if(a&&J){var e=
L(R,this);-1!==e&&(R.splice(e,1),N.splice(e,1))}return a?a(b):this}},function(){return this},function(){return{state:"rejected",reason:b}});e(d,b);return d}function q(e){return a({when:function(){return e},get:function(a){return e[a]},set:function(a,b){e[a]=b},"delete":function(a){delete e[a]},post:function(a,b){return null===a||void 0===a?e.apply(void 0,b):e[a].apply(e,b)},apply:function(a,b){return e.apply(a,b)},keys:function(){return D(e)}},void 0,function(){return{state:"fulfilled",value:e}})}
function v(a){var e=b();E(function(){try{a.then(e.resolve,e.reject,e.notify)}catch(b){e.reject(b)}});return e.promise}function x(a,e,b){return d(a).spread(e,b)}function O(a,e,b){return d(a).dispatch(e,b)}function S(a){return h(a,function(a){var e=0,d=b();F(a,function(b,f,n){var g;u(f)&&"fulfilled"===(g=f.inspect()).state?a[n]=g.value:(++e,h(f,function(b){a[n]=b;0===--e&&d.resolve(a)},d.reject,function(a){d.notify({index:n,value:a})}))},void 0);0===e&&d.resolve(a);return d.promise})}function ba(a){return h(a,
function(a){a=M(a,d);return h(S(M(a,function(a){return h(a,P,P)})),function(){return a})})}var T=!1;try{throw Error();}catch(Z){T=!!Z.stack}var U=r(),K,P=function(){},E=function(){function a(){for(;e.next;){e=e.next;var b=e.task;e.task=void 0;var f=e.domain;f&&(e.domain=void 0,f.enter());try{b()}catch(g){if(n)throw f&&f.exit(),setTimeout(a,0),f&&f.enter(),g;setTimeout(function(){throw g;},0)}f&&f.exit()}d=!1}var e={task:void 0,next:null},b=e,d=!1,f=void 0,n=!1;E=function(a){b=b.next={task:a,domain:n&&
process.domain,next:null};d||(d=!0,f())};if("undefined"!==typeof process&&process.nextTick)n=!0,f=function(){process.nextTick(a)};else if("function"===typeof setImmediate)f="undefined"!==typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!==typeof MessageChannel){var g=new MessageChannel;g.port1.onmessage=function(){f=q;g.port1.onmessage=a;a()};var q=function(){g.port2.postMessage(0)},f=function(){setTimeout(a,0);q()}}else f=function(){setTimeout(a,0)};return E}(),
I=Function.call,z=g(Array.prototype.slice),F=g(Array.prototype.reduce||function(a,e){var b=0,d=this.length;if(1===arguments.length){do{if(b in this){e=this[b++];break}if(++b>=d)throw new TypeError;}while(1)}for(;b<d;b++)b in this&&(e=a(e,this[b],b));return e}),L=g(Array.prototype.indexOf||function(a){for(var e=0;e<this.length;e++)if(this[e]===a)return e;return-1}),M=g(Array.prototype.map||function(a,e){var b=this,d=[];F(b,function(f,n,g){d.push(a.call(e,n,g,b))},void 0);return d}),X=Object.create||
function(a){function e(){}e.prototype=a;return new e},W=g(Object.prototype.hasOwnProperty),D=Object.keys||function(a){var e=[],b;for(b in a)W(a,b)&&e.push(b);return e},G=g(Object.prototype.toString),C;C="undefined"!==typeof ReturnValue?ReturnValue:function(a){this.value=a};d.resolve=d;d.nextTick=E;d.longStackSupport=!1;d.defer=b;b.prototype.makeNodeResolver=function(){var a=this;return function(e,b){e?a.reject(e):2<arguments.length?a.resolve(z(arguments,1)):a.resolve(b)}};d.Promise=t;d.promise=t;
t.race=p;t.all=S;t.reject=n;t.resolve=d;d.passByCopy=function(a){return a};a.prototype.passByCopy=function(){return this};d.join=function(a,e){return d(a).join(e)};a.prototype.join=function(a){return d([this,a]).spread(function(a,e){if(a===e)return a;throw Error("Can't join: not the same: "+a+" "+e);})};d.race=p;a.prototype.race=function(){return this.then(d.race)};d.makePromise=a;a.prototype.toString=function(){return"[object Promise]"};a.prototype.then=function(a,e,f){function g(e){try{return"function"===
typeof a?a(e):e}catch(b){return n(b)}}function q(a){if("function"===typeof e){k(a,h);try{return e(a)}catch(b){return n(b)}}return n(a)}var h=this,l=b(),v=!1;E(function(){h.promiseDispatch(function(a){v||(v=!0,l.resolve(g(a)))},"when",[function(a){v||(v=!0,l.resolve(q(a)))}])});h.promiseDispatch(void 0,"when",[void 0,function(a){var e,b=!1;try{e="function"===typeof f?f(a):a}catch(n){if(b=!0,d.onerror)d.onerror(n);else throw n;}b||l.notify(e)}]);return l.promise};d.when=h;a.prototype.thenResolve=function(a){return this.then(function(){return a})};
d.thenResolve=function(a,e){return d(a).thenResolve(e)};a.prototype.thenReject=function(a){return this.then(function(){throw a;})};d.thenReject=function(a,e){return d(a).thenReject(e)};d.nearer=m;d.isPromise=u;d.isPromiseAlike=w;d.isPending=function(a){return u(a)&&"pending"===a.inspect().state};a.prototype.isPending=function(){return"pending"===this.inspect().state};d.isFulfilled=function(a){return!u(a)||"fulfilled"===a.inspect().state};a.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state};
d.isRejected=function(a){return u(a)&&"rejected"===a.inspect().state};a.prototype.isRejected=function(){return"rejected"===this.inspect().state};var N=[],R=[],J=!0;d.resetUnhandledRejections=l;d.getUnhandledReasons=function(){return N.slice()};d.stopUnhandledRejectionTracking=function(){l();J=!1};l();d.reject=n;d.fulfill=q;d.master=function(e){return a({isDef:function(){}},function(a,b){return O(e,a,b)},function(){return d(e).inspect()})};d.spread=x;a.prototype.spread=function(a,e){return this.all().then(function(e){return a.apply(void 0,
e)},e)};d.async=function(a){return function(){function e(a,g){var q;if("undefined"===typeof StopIteration){try{q=b[a](g)}catch(k){return n(k)}return q.done?q.value:h(q.value,d,f)}try{q=b[a](g)}catch(l){return"[object StopIteration]"===G(l)||l instanceof C?l.value:n(l)}return h(q,d,f)}var b=a.apply(this,arguments),d=e.bind(e,"next"),f=e.bind(e,"throw");return d()}};d.spawn=function(a){d.done(d.async(a)())};d["return"]=function(a){throw new C(a);};d.promised=function(a){return function(){return x([this,
S(arguments)],function(e,b){return a.apply(e,b)})}};d.dispatch=O;a.prototype.dispatch=function(a,e){var d=this,f=b();E(function(){d.promiseDispatch(f.resolve,a,e)});return f.promise};d.get=function(a,e){return d(a).dispatch("get",[e])};a.prototype.get=function(a){return this.dispatch("get",[a])};d.set=function(a,e,b){return d(a).dispatch("set",[e,b])};a.prototype.set=function(a,e){return this.dispatch("set",[a,e])};d.del=d["delete"]=function(a,e){return d(a).dispatch("delete",[e])};a.prototype.del=
a.prototype["delete"]=function(a){return this.dispatch("delete",[a])};d.mapply=d.post=function(a,e,b){return d(a).dispatch("post",[e,b])};a.prototype.mapply=a.prototype.post=function(a,e){return this.dispatch("post",[a,e])};d.send=d.mcall=d.invoke=function(a,e){return d(a).dispatch("post",[e,z(arguments,2)])};a.prototype.send=a.prototype.mcall=a.prototype.invoke=function(a){return this.dispatch("post",[a,z(arguments,1)])};d.fapply=function(a,e){return d(a).dispatch("apply",[void 0,e])};a.prototype.fapply=
function(a){return this.dispatch("apply",[void 0,a])};d["try"]=d.fcall=function(a){return d(a).dispatch("apply",[void 0,z(arguments,1)])};a.prototype.fcall=function(){return this.dispatch("apply",[void 0,z(arguments)])};d.fbind=function(a){var e=d(a),b=z(arguments,1);return function(){return e.dispatch("apply",[this,b.concat(z(arguments))])}};a.prototype.fbind=function(){var a=this,e=z(arguments);return function(){return a.dispatch("apply",[this,e.concat(z(arguments))])}};d.keys=function(a){return d(a).dispatch("keys",
[])};a.prototype.keys=function(){return this.dispatch("keys",[])};d.all=S;a.prototype.all=function(){return S(this)};d.allResolved=function(a,e,b){return function(){"undefined"!==typeof console&&"function"===typeof console.warn&&console.warn(e+" is deprecated, use "+b+" instead.",Error("").stack);return a.apply(a,arguments)}}(ba,"allResolved","allSettled");a.prototype.allResolved=function(){return ba(this)};d.allSettled=function(a){return d(a).allSettled()};a.prototype.allSettled=function(){return this.then(function(a){return S(M(a,
function(a){function e(){return a.inspect()}a=d(a);return a.then(e,e)}))})};d.fail=d["catch"]=function(a,e){return d(a).then(void 0,e)};a.prototype.fail=a.prototype["catch"]=function(a){return this.then(void 0,a)};d.progress=function(a,e){return d(a).then(void 0,void 0,e)};a.prototype.progress=function(a){return this.then(void 0,void 0,a)};d.fin=d["finally"]=function(a,e){return d(a)["finally"](e)};a.prototype.fin=a.prototype["finally"]=function(a){a=d(a);return this.then(function(e){return a.fcall().then(function(){return e})},
function(e){return a.fcall().then(function(){throw e;})})};d.done=function(a,e,b,f){return d(a).done(e,b,f)};a.prototype.done=function(a,e,b){var f=function(a){E(function(){k(a,n);if(d.onerror)d.onerror(a);else throw a;})},n=a||e||b?this.then(a,e,b):this;"object"===typeof process&&process&&process.domain&&(f=process.domain.bind(f));n.then(void 0,f)};d.timeout=function(a,e,b){return d(a).timeout(e,b)};a.prototype.timeout=function(a,e){var d=b(),f=setTimeout(function(){d.reject(Error(e||"Timed out after "+
a+" ms"))},a);this.then(function(a){clearTimeout(f);d.resolve(a)},function(a){clearTimeout(f);d.reject(a)},d.notify);return d.promise};d.delay=function(a,e){void 0===e&&(e=a,a=void 0);return d(a).delay(e)};a.prototype.delay=function(a){return this.then(function(e){var d=b();setTimeout(function(){d.resolve(e)},a);return d.promise})};d.nfapply=function(a,e){return d(a).nfapply(e)};a.prototype.nfapply=function(a){var e=b();a=z(a);a.push(e.makeNodeResolver());this.fapply(a).fail(e.reject);return e.promise};
d.nfcall=function(a){var e=z(arguments,1);return d(a).nfapply(e)};a.prototype.nfcall=function(){var a=z(arguments),e=b();a.push(e.makeNodeResolver());this.fapply(a).fail(e.reject);return e.promise};d.nfbind=d.denodeify=function(a){var e=z(arguments,1);return function(){var f=e.concat(z(arguments)),n=b();f.push(n.makeNodeResolver());d(a).fapply(f).fail(n.reject);return n.promise}};a.prototype.nfbind=a.prototype.denodeify=function(){var a=z(arguments);a.unshift(this);return d.denodeify.apply(void 0,
a)};d.nbind=function(a,e){var f=z(arguments,2);return function(){var n=f.concat(z(arguments)),g=b();n.push(g.makeNodeResolver());d(function(){return a.apply(e,arguments)}).fapply(n).fail(g.reject);return g.promise}};a.prototype.nbind=function(){var a=z(arguments,0);a.unshift(this);return d.nbind.apply(void 0,a)};d.nmapply=d.npost=function(a,e,b){return d(a).npost(e,b)};a.prototype.nmapply=a.prototype.npost=function(a,e){var d=z(e||[]),f=b();d.push(f.makeNodeResolver());this.dispatch("post",[a,d]).fail(f.reject);
return f.promise};d.nsend=d.nmcall=d.ninvoke=function(a,e){var f=z(arguments,2),n=b();f.push(n.makeNodeResolver());d(a).dispatch("post",[e,f]).fail(n.reject);return n.promise};a.prototype.nsend=a.prototype.nmcall=a.prototype.ninvoke=function(a){var e=z(arguments,1),d=b();e.push(d.makeNodeResolver());this.dispatch("post",[a,e]).fail(d.reject);return d.promise};d.nodeify=function(a,e){return d(a).nodeify(e)};a.prototype.nodeify=function(a){if(a)this.then(function(e){E(function(){a(null,e)})},function(e){E(function(){a(e)})});
else return this};var V=r();return d});
define("enketo-js/widgets",["text!enketo-config","enketo-js/support","q","jquery"],function(g,k,f,r){var d,b,t,p,a,h,m,u=[];b=function(a){for(var b,e,d=f.defer(),g=[],h=0;h<a.widgets.length;h++)b="text!"+a.widgets[h].substr(0,a.widgets[h].lastIndexOf("/")+1)+"config.json",g.push(b);require(g,function(){for(var b=0;b<arguments.length;b++)e=JSON.parse(arguments[b]),e.path=a.widgets[b],u.push(e);d.resolve(u)});return d.promise};t=function(a,b){return b?"form"===b?d:a.find(b):r()};p=function(b){u.forEach(function(d){var e;
d.options=d.options||{};d.options.touch=k.touch;if(!d.selector&&null!==d.selector)return console.error("widget configuration has no acceptable selector property",d);e=t(b,d.selector);e.length&&(d.load||(d.load=a(d)),d.load.then(function(a){a.name&&(e[a.name](a.options),h(a,e),m(a,e))}))})};a=function(a){var b=f.defer();require([a.path],function(e){a.name=e;b.resolve(a)});return b.promise};h=function(a,b){if(0<b.length)d.on("changelanguage",function(){b[a.name]("update")})};m=function(a,b){if(0<b.length&&
"select"===b.prop("nodeName").toLowerCase())d.on("changeoption","select",function(){r(this)[a.name]("update")})};return{init:function(a){d=r("form.or");a=a||d;b(JSON.parse(g)).then(function(b){p(a)})},enable:function(a){for(var b,e,d=0;d<u.length;d++)b=u[d],b.name&&(e=t(a,b.selector),e[b.name]("enable"))},disable:function(a){for(var b,e,d=0;d<u.length;d++)b=u[d],b.name&&(e=t(a,b.selector),e[b.name]("disable"))},destroy:function(a){for(var b,e,d=0;d<u.length;d++)b=u[d],b.name&&(e=t(a,b.selector),e[b.name]("destroy"))}}});
(function(g){"function"===typeof define&&define.amd&&define.amd.jQuery?define("jquery.touchswipe",["jquery"],g):g(jQuery)})(function(g){function k(d){!d||void 0!==d.allowPageScroll||void 0===d.swipe&&void 0===d.swipeStatus||(d.allowPageScroll="none");void 0!==d.click&&void 0===d.tap&&(d.tap=d.click);d||(d={});d=g.extend({},g.fn.swipe.defaults,d);return this.each(function(){var b=g(this),k=b.data("TouchSwipe");k||(k=new f(this,d),b.data("TouchSwipe",k))})}function f(d,b){function f(a){if(!0!==y.data("TouchSwipe_intouch")&&
!(0<g(a.target).closest(b.excludedElements,y).length)){var e=a.originalEvent?a.originalEvent:a,d,n=r?e.touches[0]:e;A="start";r?B=e.touches.length:a.preventDefault();D=0;Y=G=null;R=N=C=0;J=1;V=0;a=[];for(var q=0;5>=q;q++)a.push({start:{x:0,y:0},end:{x:0,y:0},identifier:0});H=a;a={};a.left=E("left");a.right=E("right");a.up=E("up");a.down=E("down");ea=a;ga=da=0;if(!r||B===b.fingers||"all"===b.fingers||x()){if(U(0,n),fa=z(),2==B&&(U(1,e.touches[1]),N=R=I(H[0].start,H[1].start)),b.swipeStatus||b.pinchStatus)d=
l(e,A)}else d=!1;if(!1===d)return A="cancel",l(e,A),d;Z(!0);return null}}function k(a){var e,d,f,n=a.originalEvent?a.originalEvent:a;if("end"!==A&&"cancel"!==A&&!T()){var q,h=K(r?n.touches[0]:n);ca=z();r&&(B=n.touches.length);A="move";2==B&&(0==N?(U(1,n.touches[1]),N=R=I(H[0].start,H[1].start)):(K(n.touches[1]),R=I(H[0].end,H[1].end),Y=1>J?"out":"in"),J=(R/N*1).toFixed(2),V=Math.abs(N-R));if(B===b.fingers||"all"===b.fingers||!r||x()){e=h.start;d=h.end;e=Math.atan2(d.y-e.y,e.x-d.x);e=Math.round(180*
e/Math.PI);0>e&&(e=360-Math.abs(e));e=G=45>=e&&0<=e?"left":360>=e&&315<=e?"left":135<=e&&225>=e?"right":45<e&&135>e?"down":"up";if("none"===b.allowPageScroll||x())a.preventDefault();else switch(d="auto"===b.allowPageScroll,e){case "left":(b.swipeLeft&&d||!d&&"horizontal"!=b.allowPageScroll)&&a.preventDefault();break;case "right":(b.swipeRight&&d||!d&&"horizontal"!=b.allowPageScroll)&&a.preventDefault();break;case "up":(b.swipeUp&&d||!d&&"vertical"!=b.allowPageScroll)&&a.preventDefault();break;case "down":(b.swipeDown&&
d||!d&&"vertical"!=b.allowPageScroll)&&a.preventDefault()}a=h.start;e=h.end;D=Math.round(Math.sqrt(Math.pow(e.x-a.x,2)+Math.pow(e.y-a.y,2)));C=ca-fa;a=G;e=D;e=Math.max(e,P(a));ea[a].distance=e;if(b.swipeStatus||b.pinchStatus)q=l(n,A);if(!b.triggerOnTouchEnd||b.triggerOnTouchLeave){a=!0;if(b.triggerOnTouchLeave){f=g(this);var v=f.offset();a=v.left;e=v.left+f.outerWidth();d=v.top;f=v.top+f.outerHeight();h=h.end;a=h.x>a&&h.x<e&&h.y>d&&h.y<f}!b.triggerOnTouchEnd&&a?A=w("move"):b.triggerOnTouchLeave&&
!a&&(A=w("end"));"cancel"!=A&&"end"!=A||l(n,A)}}else A="cancel",l(n,A);!1===q&&(A="cancel",l(n,A))}}function a(a){var d=a.originalEvent;if(r&&0<d.touches.length)return da=z(),ga=event.touches.length+1,!0;T()&&(B=ga);a.preventDefault();ca=z();C=ca-fa;q()?(A="cancel",l(d,A)):b.triggerOnTouchEnd||0==b.triggerOnTouchEnd&&"move"===A?(A="end",l(d,A)):!b.triggerOnTouchEnd&&b.tap?(A="end",e(d,A,"tap")):"move"===A&&(A="cancel",l(d,A));Z(!1);return null}function h(){R=N=fa=ca=B=0;J=1;ga=da=0;Z(!1)}function m(a){a=
a.originalEvent;b.triggerOnTouchLeave&&(A=w("end"),l(a,A))}function u(){y.unbind(L,f);y.unbind("touchcancel",h);y.unbind(M,k);y.unbind(X,a);W&&y.unbind(W,m);Z(!1)}function w(a){var e=a,d=b.maxTimeThreshold?C>=b.maxTimeThreshold?!1:!0:!0,f=n(),g=q();!d||g?e="cancel":!f||"move"!=a||b.triggerOnTouchEnd&&!b.triggerOnTouchLeave?!f&&"end"==a&&b.triggerOnTouchLeave&&(e="cancel"):e="end";return e}function l(a,d){var f=void 0;O()&&S()||S()?f=e(a,d,"swipe"):(v()&&x()||x())&&!1!==f&&(f=e(a,d,"pinch"));ba()&&
b.doubleTap&&!1!==f?f=e(a,d,"doubletap"):C>b.longTapThreshold&&10>D&&b.longTap&&!1!==f?f=e(a,d,"longtap"):!(1!==B&&r||!isNaN(D)&&0!==D)&&b.tap&&!1!==f&&(f=e(a,d,"tap"));"cancel"===d&&h(a);"end"===d&&(r?0==a.touches.length&&h(a):h(a));return f}function e(a,e,d){var f=void 0;if("swipe"==d){y.trigger("swipeStatus",[e,G||null,D||0,C||0,B]);if(b.swipeStatus&&(f=b.swipeStatus.call(y,a,e,G||null,D||0,C||0,B),!1===f))return!1;if("end"==e&&O()){y.trigger("swipe",[G,D,C,B]);if(b.swipe&&(f=b.swipe.call(y,a,
G,D,C,B),!1===f))return!1;switch(G){case "left":y.trigger("swipeLeft",[G,D,C,B]);b.swipeLeft&&(f=b.swipeLeft.call(y,a,G,D,C,B));break;case "right":y.trigger("swipeRight",[G,D,C,B]);b.swipeRight&&(f=b.swipeRight.call(y,a,G,D,C,B));break;case "up":y.trigger("swipeUp",[G,D,C,B]);b.swipeUp&&(f=b.swipeUp.call(y,a,G,D,C,B));break;case "down":y.trigger("swipeDown",[G,D,C,B]),b.swipeDown&&(f=b.swipeDown.call(y,a,G,D,C,B))}}}if("pinch"==d){y.trigger("pinchStatus",[e,Y||null,V||0,C||0,B,J]);if(b.pinchStatus&&
(f=b.pinchStatus.call(y,a,e,Y||null,V||0,C||0,B,J),!1===f))return!1;if("end"==e&&v())switch(Y){case "in":y.trigger("pinchIn",[Y||null,V||0,C||0,B,J]);b.pinchIn&&(f=b.pinchIn.call(y,a,Y||null,V||0,C||0,B,J));break;case "out":y.trigger("pinchOut",[Y||null,V||0,C||0,B,J]),b.pinchOut&&(f=b.pinchOut.call(y,a,Y||null,V||0,C||0,B,J))}}if("tap"==d){if("cancel"===e||"end"===e)clearTimeout(ha),b.doubleTap&&!ba()?(aa=z(),ha=setTimeout(g.proxy(function(){aa=null;y.trigger("tap",[a.target]);b.tap&&(f=b.tap.call(y,
a,a.target))},this),b.doubleTapThreshold)):(aa=null,y.trigger("tap",[a.target]),b.tap&&(f=b.tap.call(y,a,a.target)))}else if("doubletap"==d){if("cancel"===e||"end"===e)clearTimeout(ha),aa=null,y.trigger("doubletap",[a.target]),b.doubleTap&&(f=b.doubleTap.call(y,a,a.target))}else"longtap"!=d||"cancel"!==e&&"end"!==e||(clearTimeout(ha),aa=null,y.trigger("longtap",[a.target]),b.longTap&&(f=b.longTap.call(y,a,a.target)));return f}function n(){var a=!0;null!==b.threshold&&(a=D>=b.threshold);return a}function q(){var a=
!1;null!==b.cancelThreshold&&null!==G&&(a=P(G)-D>=b.cancelThreshold);return a}function v(){var a=B===b.fingers||"all"===b.fingers||!r,e=0!==H[0].end.x,d;d=null!==b.pinchThreshold?V>=b.pinchThreshold:!0;return a&&e&&d}function x(){return!!(b.pinchStatus||b.pinchIn||b.pinchOut)}function O(){var a=b.maxTimeThreshold?C>=b.maxTimeThreshold?!1:!0:!0,e=n(),d=B===b.fingers||"all"===b.fingers||!r,f=0!==H[0].end.x;return!q()&&f&&d&&e&&a}function S(){return!!(b.swipe||b.swipeStatus||b.swipeLeft||b.swipeRight||
b.swipeUp||b.swipeDown)}function ba(){if(null==aa)return!1;var a=z();return!!b.doubleTap&&a-aa<=b.doubleTapThreshold}function T(){var a=!1;da&&z()-da<=b.fingerReleaseThreshold&&(a=!0);return a}function Z(e){!0===e?(y.bind(M,k),y.bind(X,a),W&&y.bind(W,m)):(y.unbind(M,k,!1),y.unbind(X,a,!1),W&&y.unbind(W,m,!1));y.data("TouchSwipe_intouch",!0===e)}function U(a,e){H[a].identifier=void 0!==e.identifier?e.identifier:0;H[a].start.x=H[a].end.x=e.pageX||e.clientX;H[a].start.y=H[a].end.y=e.pageY||e.clientY;
return H[a]}function K(a){var e=void 0!==a.identifier?a.identifier:0;a:{for(var b=0;b<H.length;b++)if(H[b].identifier==e){e=H[b];break a}e=void 0}e.end.x=a.pageX||a.clientX;e.end.y=a.pageY||a.clientY;return e}function P(a){if(ea[a])return ea[a].distance}function E(a){return{direction:a,distance:0}}function I(a,e){var b=Math.abs(a.x-e.x),d=Math.abs(a.y-e.y);return Math.round(Math.sqrt(b*b+d*d))}function z(){return(new Date).getTime()}var F=r||!b.fallbackToMouseEvents,L=F?"touchstart":"mousedown",M=
F?"touchmove":"mousemove",X=F?"touchend":"mouseup",W=F?null:"mouseleave",D=0,G=null,C=0,N=0,R=0,J=1,V=0,Y=0,ea=null,y=g(d),A="start",B=0,H=null,fa=0,ca=0,da=0,ga=0,aa=0,ha=null;try{y.bind(L,f),y.bind("touchcancel",h)}catch(ia){g.error("events not supported "+L+",touchcancel on jQuery.swipe")}this.enable=function(){y.bind(L,f);y.bind("touchcancel",h);return y};this.disable=function(){u();return y};this.destroy=function(){u();y.data("TouchSwipe",null);return y};this.option=function(a,e){if(void 0!==
b[a]){if(void 0===e)return b[a];b[a]=e}else g.error("Option "+a+" does not exist on jQuery.swipe.options");return null}}var r="ontouchstart"in window;g.fn.swipe=function(d){var b=g(this),f=b.data("TouchSwipe");if(f&&"string"===typeof d){if(f[d])return f[d].apply(this,Array.prototype.slice.call(arguments,1));g.error("Method "+d+" does not exist on jQuery.swipe")}else if(!(f||"object"!==typeof d&&d))return k.apply(this,arguments);return b};g.fn.swipe.defaults={fingers:1,threshold:75,cancelThreshold:null,
pinchThreshold:20,maxTimeThreshold:null,fingerReleaseThreshold:250,longTapThreshold:500,doubleTapThreshold:200,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,pinchIn:null,pinchOut:null,pinchStatus:null,click:null,tap:null,doubleTap:null,longTap:null,triggerOnTouchEnd:!0,triggerOnTouchLeave:!1,allowPageScroll:"auto",fallbackToMouseEvents:!0,excludedElements:"label, button, input, select, textarea, a, .noSwipe"};g.fn.swipe.phases={PHASE_START:"start",PHASE_MOVE:"move",
PHASE_END:"end",PHASE_CANCEL:"cancel"};g.fn.swipe.directions={LEFT:"left",RIGHT:"right",UP:"up",DOWN:"down",IN:"in",OUT:"out"};g.fn.swipe.pageScroll={NONE:"none",HORIZONTAL:"horizontal",VERTICAL:"vertical",AUTO:"auto"};g.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,ALL:"all"}});
define("enketo-js/Form","enketo-js/FormModel enketo-js/widgets jquery enketo-js/plugins enketo-js/extend jquery.touchswipe".split(" "),function(g,k,f){return function(r,d){function b(a){this.$=h=f(a);this.$nonRepeats={}}var t,p,a,h,m,u,w,l=[];this.init=function(){m=f(r).clone().appendTo("<original></original>");t=new g(d);l=l.concat(t.init());a=new b(r);u=0<f(r).find(".or-repeat").length;a.init();window.scrollTo&&window.scrollTo(0,0);return l};this.ex=function(a,b,d,f,g){return t.evaluate(a,b,d,f,
g)};this.getModel=function(){return t};this.getInstanceID=function(){return t.getInstanceID()};this.getInstanceName=function(){return t.getInstanceName()};this.getView=function(){return a};this.getEncryptionKey=function(){return a.$.data("base64rsapublickey")};this.getDataStr=function(){return t.getStr()};this.getRecordName=function(){return a.recordName.get()};this.setRecordName=function(e){return a.recordName.set(e)};this.setEditStatus=function(e){return a.editStatus.set(e)};this.getEditStatus=
function(){return a.editStatus.get()};this.getSurveyName=function(){return h.find("#form-title").text()};this.resetHTML=this.resetView=function(){f("#form-languages").remove();h.replaceWith(m)};this.validate=function(){return a.validateAll()};this.isValid=function(){return a.isValid()};w=function(a,b,d,g,k){var l,p="",m=a.match(/jr:choice-name\(([^,]+),\s?'(.*?)'\)/);return m?(l=t.evaluate(m[1],b,d,g,k),b=m[2].trim(),b=h.find('[name="'+b+'"]'),0<b.length&&"select"===b.prop("nodeName").toLowerCase()?
p=b.find('[value="'+l+'"]').text():0<b.length&&"input"===b.prop("nodeName").toLowerCase()&&(p=b.filter(function(){return f(this).attr("value")===l}).siblings(".option-label.active").text()),a.replace(m[0],'"'+p+'"')):a};b.prototype.init=function(){var a=this;if("undefined"===typeof t||!(t instanceof g))return console.error("variable data needs to be defined as instance of FormModel");this.preloads.init(this);this.grosslyViolateStandardComplianceByIgnoringCertainCalcs();this.calcUpdate();this.langs.init();
this.repeat.init(this);this.itemsetUpdate();this.setAllVals();k.init();this.branchUpdate();this.pages.init();this.outputUpdate();this.setEventHandlers();this.editStatus.set(!1);setTimeout(function(){a.progress.update()},0)};b.prototype.pages={active:!1,$current:[],$activePages:f(),init:function(){if(h.hasClass("pages")){var a=h.find(".note, .question, .trigger, .or-appearance-field-list").filter(function(){return 0===f(this).parent().closest(".or-appearance-field-list").length}).attr("role","page");
if(1<a.length||a.eq(0).hasClass("or-repeat"))this.$formFooter=f(".form-footer"),this.$btnFirst=this.$formFooter.find(".first-page"),this.$btnPrev=this.$formFooter.find(".previous-page"),this.$btnNext=this.$formFooter.find(".next-page"),this.$btnLast=this.$formFooter.find(".last-page"),this.updateAllActive(a),this.toggleButtons(0),this.setButtonHandlers(),this.setRepeatHandlers(),this.setBranchHandlers(),this.setSwipeHandlers(),this.active=!0;this.flipToFirst();h.show()}},setButtonHandlers:function(){var a=
this;this.$btnFirst.off(".pagemode").on("click.pagemode",function(){a.flipToFirst();return!1});this.$btnPrev.off(".pagemode").on("click.pagemode",function(){a.prev();return!1});this.$btnNext.off(".pagemode").on("click.pagemode",function(){a.next();return!1});this.$btnLast.off(".pagemode").on("click.pagemode",function(){a.flipToLast();return!1})},setSwipeHandlers:function(){var a=this;f(".main").swipe("destroy").swipe({allowPageScroll:"vertical",threshold:75,swipeLeft:function(){a.next()},swipeRight:function(){a.prev()}})},
setRepeatHandlers:function(){var a=this;h.off("addrepeat.pagemode").on("addrepeat.pagemode",function(b){a.updateAllActive();f(b.target).removeClass("current contains-current").find(".current").removeClass("current");a.flipToPageContaining(f(b.target))}).off("removerepeat.pagemode").on("removerepeat.pagemode",function(b){0===a.$current.closest("html").length&&(a.updateAllActive(),a.flipToPageContaining(f(b.target)))})},setBranchHandlers:function(){var a=this;h.off("changebranch.pagemode").on("changebranch.pagemode",
function(){a.updateAllActive();a.toggleButtons()})},getCurrent:function(){return this.$current},updateAllActive:function(a){a=a||f('.or [role="page"]');this.$activePages=a.filter(function(){return 0===f(this).closest(".disabled").length})},getAllActive:function(){return this.$activePages},getPrev:function(a){return this.$activePages[a-1]},getNext:function(a){return this.$activePages[a+1]},getCurrentIndex:function(){return this.$activePages.index(this.$current)},next:function(){var a,b;this.updateAllActive();
b=this.getCurrentIndex();(a=this.getNext(b))&&this.flipTo(a,b+1)},prev:function(){var a,b;this.updateAllActive();b=this.getCurrentIndex();(a=this.getPrev(b))&&this.flipTo(a,b-1)},setToCurrent:function(a){a=f(a);a.addClass("current hidden");this.$current=a.removeClass("hidden").parentsUntil(".or",".or-group, .or-group-data, .or-repeat").addClass("contains-current").end()},flipTo:function(a,b){0<this.$current.length&&1===this.$current.closest("html").length?this.$current[0]!==a&&(this.$current.removeClass("current fade-out").parentsUntil(".or",
".or-group, .or-group-data, .or-repeat").removeClass("contains-current"),this.setToCurrent(a),this.focusOnFirstQuestion(a),this.toggleButtons(b)):(this.setToCurrent(a),this.focusOnFirstQuestion(a),this.toggleButtons(b));window.scrollTo&&window.scrollTo(0,0);f(a).trigger("pageflip.enketo")},flipToFirst:function(){this.updateAllActive();this.flipTo(this.$activePages[0])},flipToLast:function(){this.updateAllActive();this.flipTo(this.$activePages.last()[0])},flipToPageContaining:function(a){var b;b=a.closest('[role="page"]');
b=0===b.length?a.find('[role="page"]'):b;this.flipTo(b[0])},focusOnFirstQuestion:function(a){f(a).find(".question:not(.disabled)").filter(function(){return 0===f(this).parentsUntil(".or",".disabled").length}).eq(0).find("input, select, textarea").eq(0).trigger("fakefocus")},toggleButtons:function(a){var b=a||this.getCurrentIndex();a=this.getNext(b);b=this.getPrev(b);this.$btnNext.add(this.$btnLast).toggleClass("disabled",!a);this.$btnPrev.add(this.$btnFirst).toggleClass("disabled",!b);this.$formFooter.toggleClass("end",
!a)}};b.prototype.input={getWrapNodes:function(a){return"fieldset"===this.getInputType(a.eq(0))?a:a.closest(".question, .note")},getProps:function(a){return 1!==a.length?console.error("getProps(): no input node provided or multiple"):{path:this.getName(a),ind:this.getIndex(a),inputType:this.getInputType(a),xmlType:this.getXmlType(a),constraint:this.getConstraint(a),calculation:this.getCalculation(a),relevant:this.getRelevant(a),val:this.getVal(a),required:this.isRequired(a),enabled:this.isEnabled(a),
multiple:this.isMultiple(a)}},getInputType:function(a){var b;if(1!==a.length)return"";b=a.prop("nodeName").toLowerCase();return"input"===b?0<a.attr("type").length?a.attr("type").toLowerCase():console.error("<input> node has no type"):"select"===b?"select":"textarea"===b?"textarea":"fieldset"===b||"section"===b?"fieldset":console.error("unexpected input node type provided")},getConstraint:function(a){return a.attr("data-constraint")},getRelevant:function(a){return a.attr("data-relevant")},getCalculation:function(a){return a.attr("data-calculate")},
getXmlType:function(a){return 1!==a.length?console.error("getXMLType(): no input node provided or multiple"):a.attr("data-type-xml")},getName:function(a){return 1!==a.length?console.error("getName(): no input node provided or multiple"):a.attr("data-name")||a.attr("name")||console.error("input node has no name")},getIndex:function(a){var b,d,f;if(1!==a.length)return console.error("getIndex(): no input node provided or multiple");b=this.getInputType(a);d=this.getName(a);f=this.getWrapNodes(a);return("radio"===
b&&d!==a.attr("name")?this.getWrapNodes(h.find('[data-name="'+d+'"]')):"fieldset"===b&&a.hasClass("or-repeat")?this.getWrapNodes(h.find('.or-repeat[name="'+d+'"]')):"fieldset"===b&&a.hasClass("or-group")?this.getWrapNodes(h.find('.or-group[name="'+d+'"]')):this.getWrapNodes(h.find('[name="'+d+'"]'))).index(f)},isMultiple:function(a){return"checkbox"===this.getInputType(a)||void 0!==a.attr("multiple")?!0:!1},isEnabled:function(a){return!(a.prop("disabled")||0<a.parentsUntil(".or",".disabled").length)},
isRequired:function(a){return void 0!==a.attr("required")&&0===a.parentsUntil(".or",".or-appearance-label").length},getVal:function(a){var b,d=[],g;if(1!==a.length)return console.error("getVal(): no inputNode provided or multiple");b=this.getInputType(a);g=this.getName(a);return"radio"===b?this.getWrapNodes(a).find("input:checked").val()||"":"checkbox"===b?(this.getWrapNodes(a).find('input[name="'+g+'"]:checked').each(function(){d.push(f(this).val())}),d):a.val()?f.isArray(a.val())?a.val().join(" ").trim():
a.val().trim():""},setVal:function(a,b,d){var f,g;b=b||0;if("radio"===this.getInputType(h.find('[data-name="'+a+'"]').eq(0)))a=this.getWrapNodes(h.find('[data-name="'+a+'"]')).eq(b).find('input[value="'+d+'"]'),a.prop("checked",!0);else{f=this.getWrapNodes(h.find('[name="'+a+'"]').eq(b)).find('[name="'+a+'"]');g=this.getInputType(f.eq(0));if("file"===g)return f.eq(0).attr("data-loaded-file-name",d),!1;if("date"===g||"datetime"===g)d=t.node(a,b).convert(d,g);!0===this.isMultiple(f.eq(0))&&(d=d.split(" "));
f.is("[readonly]")&&f.toggleClass("has-value",!!d);f.val(d)}}};b.prototype.setAllVals=function(a,b){var d,g,h,k=this,p=a&&a.attr("name")?a.attr("name"):null;t.node(p,"undefined"!==typeof b?b:null).get().find("*").filter(function(){var a=f(this);return 0===a.children().length&&a.text()}).each(function(){var a=f(this);try{h=a.text(),g=a.getXPath("instance"),d=t.node(g).get().index(this),k.input.setVal(g,d,h)}catch(e){console.error(e),l.push("Could not load input field value with name: "+g+" and value: "+
h)}})};b.prototype.langs={init:function(){var a,b=this,d=h.find("#form-languages").attr("data-default-lang"),g=f(".form-language-selector");f("#form-languages").detach().appendTo(g);d&&""!==d||(d=f("#form-languages option").eq(0).attr("value"));f("#form-languages").val(d);2>f("#form-languages option").length||(g.removeClass("hide"),f("#form-languages").change(function(d){a=f(this).val();d.preventDefault();b.setAll(a)}))},setAll:function(a){var b=this;f("#form-languages option").removeClass("active");
f(this).addClass("active");h.find("[lang]").removeClass("active").filter('[lang="'+a+'"], [lang=""]').filter(function(){var a=f(this);return!a.hasClass("or-form-short")||a.hasClass("or-form-short")&&0===a.siblings(".or-form-long").length}).addClass("active");h.find("select").each(function(){b.setSelect(f(this))});h.trigger("changelanguage")},setSelect:function(a){var b,d,g;a.children("option").not('[value=""]').each(function(){var a=f(this);d=a.text();b=a.attr("value");g=a.parent("select").siblings(".or-option-translations").children('.active[data-option-value="'+
b+'"]').text().trim();g="undefined"!==typeof g&&0<g.length?g:d;a.text(g)})}};b.prototype.editStatus={set:function(a){a&&a!==h.data("edited")&&h.trigger("edited.enketo");h.data("edited",a)},get:function(){return!!h.data("edited")}};b.prototype.recordName={set:function(a){h.attr("name",a)},get:function(){return h.attr("name")}};b.prototype.getNodesToUpdate=function(a,b,d){var g;g=null;var k=[],l=this;d=d||{};b=b||"";this.$nonRepeats[a]||(this.$nonRepeats[a]=h.find(b+"["+a+"]").parentsUntil(".or",".calculation, .question, .note, .trigger").filter(function(){return 0===
f(this).closest(".or-repeat").length}));"undefined"!==typeof d.repeatPath&&0<=d.repeatIndex&&(g=h.find('.or-repeat[name="'+d.repeatPath+'"]').eq(d.repeatIndex));g=g?this.$nonRepeats[a].add(g):h;d.nodes&&0!==d.nodes.length?(d.nodes.forEach(function(d){k=k.concat(l.getQuerySelectorsForLogic(b,a,d))}),k=k.concat(l.getQuerySelectorsForLogic(b,a,"*"))):k=k.concat([b+"["+a+"]"]);return g.find(k.join())};b.prototype.getQuerySelectorsForLogic=function(a,b,d){return[a+"["+b+'*="/'+d+' "]',a+"["+b+'*="/'+d+
')"]',a+"["+b+'*="/'+d+',"]',a+"["+b+'$="/'+d+'"]',a+"["+b+'*="/'+d+']"]']};b.prototype.branchUpdate=function(a){var b,d,g;function l(a){return!a.hasClass("disabled")&&!a.hasClass("pre-init")}function p(a){var b=a.prop("nodeName").toLowerCase(),e=a.hasClass("pre-init");if(e||l(a))E=!0,a.addClass("disabled"),e?a.removeClass("pre-init"):(a.clearInputs("change"),k.disable(a),a.find(".invalid-required, .invalid-constraint").find("input, select, textarea").each(function(){I.setValid(f(this))})),"label"===
b?a.children("input, select, textarea").prop("disabled",!0):"fieldset"===b?a.prop("disabled",!0):a.find("fieldset, input, select, textarea").prop("disabled",!0)}var m,r,T,Z,w,K={},P=[],E=!1,I=this,z=0,F;a=this.getNodesToUpdate("data-relevant","",a);F=u&&0<h.find(".or-repeat.clone").length?!0:!1;a.each(function(){var a=f(this);if(-1===f.inArray(a.attr("name"),P)&&(m=a.closest(".or-branch"),!m.parent().closest(".disabled").length))if(g=d=b=void 0,w=null,b=I.input.getRelevant(a),d=I.input.getName(a),
1!==m.length)0===a.parentsUntil(".or","#or-calculated-items").length&&console.error("could not find branch node for ",f(this));else if(T=F&&0<m.parentsUntil(".or",".or-repeat").length?!0:!1,g=(Z=F&&0<m.parentsUntil(".or",".or-repeat.clone").length?!0:!1)?I.input.getIndex(a):0,-1===b.indexOf("..")&&(w=T?b+"__"+d.substring(0,d.lastIndexOf("/"))+"__"+g:b),w&&"undefined"!==typeof K[w]?r=K[w]:(r=t.evaluate(b,"boolean",d,g),z++,K[w]=r),T||P.push(f(this).attr("name")),a=m,!0===r){var e;l(a)||(E=!0,a.removeClass("disabled pre-init"),
k.enable(a),e=a.prop("nodeName").toLowerCase(),"label"===e?a.children("input, select, textarea").prop("disabled",!1):"fieldset"===e?(a.prop("disabled",!1),a.find('*:not(.or-branch) input[type="file"]:not([data-relevant])').prop("disabled",!0).prop("disabled",!1)):a.find("fieldset, input, select, textarea").prop("disabled",!1))}else p(a)});E&&this.$.trigger("changebranch")};b.prototype.itemsetUpdate=function(a){var b,d,g,k=this,l={};a=this.getNodesToUpdate("data-items-path",".itemset-template",a);
b=u&&0<h.find(".or-repeat.clone").length?!0:!1;a.each(function(){var a,e,h,m,p,u,r,w,I,z,F,L,M,X,W,D;r=f(this);r.parentsUntil(".or",".or-branch").parentsUntil(".or",".disabled").length||(w={},I=r.data(),z=r.prop("nodeName").toLowerCase(),F="label"===z?r.children("input").eq(0):r.parent("select"),L=r.closest("label, select").siblings(".itemset-labels"),M=r.attr("data-items-path"),X=L.attr("data-label-type"),W=L.attr("data-label-ref"),D=L.attr("data-value-ref"),p=k.input.getName(F),d=b&&0<F.parentsUntil(".or",
".or-repeat").length?!0:!1,m=(g=b&&0<F.parentsUntil(".or",".or-repeat.clone").length?!0:!1)?k.input.getIndex(F):0,"undefined"!==typeof l[M]?m=l[M]:(m=f(t.evaluate(M,"nodes",p,m,!0)),d||(l[M]=m)),w.length=m.length,w.text=m.text(),w.length===I.length&&w.text===I.text)||(r.data(w),r.closest(".question").clearInputs("change").find(z).not(r).remove(),r.parent("select").siblings(".or-option-translations").empty(),m.each(function(){var b=f(this);u=b.children(W).text();a=f("<root/>");r.clone().appendTo(a).removeClass("itemset-template").addClass("itemset").removeAttr("data-items-path");
e="itext"===X&&0<L.find('[data-itext-id="'+u+'"]').length?L.find('[data-itext-id="'+u+'"]').clone():f('<span class="option-label active" lang="">'+u+"</span>");h=b.children(D).text();a.find("[value]").attr("value",h);"label"===z?(a.find("input").after(e),L.before(a.find(":first"))):"option"===z&&(1===e.length&&a.find("option").text(e.text()),e.attr("data-option-value",h).attr("data-itext-id","").appendTo(L.siblings(".or-option-translations")),r.siblings().addBack().last().after(a.find(":first")))}),
"select"===F.prop("nodeName").toLowerCase()&&(k.langs.setSelect(F),F.trigger("changeoption")))})};b.prototype.outputUpdate=function(a){var b,d,g,k,l,m,p,r,w={},U="",K=this;a=this.getNodesToUpdate("data-value",".or-output",a);d=u&&0<h.find(".or-repeat.clone").length;a.each(function(){m=f(this);m.closest(".or-branch").parent().closest(".disabled").length||(b=m.attr("data-value"),l=m.closest(".question, .note, .or-group").find("[name]").eq(0),p=l.length?K.input.getName(l):void 0,r=(k=(g=d&&0<m.parentsUntil(".or",
".or-repeat").length)&&0<m.parentsUntil(".or",".or-repeat.clone").length)?K.input.getIndex(l):0,"undefined"!==typeof w[b]?U=w[b]:(U=t.evaluate(b,"string",p,r,!0),g||(w[b]=U)),m.text!==U&&m.text(U))})};b.prototype.grosslyViolateStandardComplianceByIgnoringCertainCalcs=function(){var a=h.find('[name$="/meta/instanceID"][data-calculate]');0<a.length&&a.removeAttr("data-calculate")};b.prototype.calcUpdate=function(a){var b,d=this;a=a||{};b=this.getNodesToUpdate("data-calculate","",a);b=b.add(this.getNodesToUpdate("data-relevant",
"[data-calculate]",a));b.each(function(){function b(a){m=w(m,"string",l,a);g=u&&m?t.evaluate(m,"string",l,a):"";n.setIndex(a);n.setVal(g,r,p);d.input.setVal(l,a,g)}var g,n,h,k,l,m,p,r,u;h=f(this);l=d.input.getName(h);k=-1!==l.lastIndexOf("/")?l.substring(l.lastIndexOf("/")+1):l;m=d.input.getCalculation(h);p=d.input.getXmlType(h);r=d.input.getConstraint(h);u=(h=d.input.getRelevant(h))?t.evaluate(h,"boolean",l):!0;n=t.node(l);h=n.get();1<h.length&&a.repeatPath&&-1!==l.indexOf(a.repeatPath)?(k=t.node(a.repeatPath,
a.repeatIndex).get().find(k),k=f(h).index(k),b(k)):1===h.length?b(0):h.each(function(a){b(a)})})};b.prototype.preloads={init:function(a){var b,d,g,k,l,m,p,r,u,w=this;h.find("#or-preload-items input").each(function(){u=f(this);p=a.input.getProps(u);b=u.attr("data-preload").toLowerCase();d=u.attr("data-preload-params").toLowerCase();"undefined"!==typeof w[b]?(m=t.node(p.path,p.index),k=m.getVal()[0],l=w[b]({param:d,curVal:k,dataNode:m}),m.setVal(l,null,p.xmlType)):console.log('Preload "'+b+'" not supported. May or may not be a big deal.')});
t.node("/*/meta/*").get().each(function(){b=null;g=f(this).prop("nodeName");m=t.node("/*/meta/"+g);k=m.getVal()[0];if(0===h.find('#or-preload-items input[name$="/meta/'+g+'"][data-preload]').length)switch(g){case "instanceID":b="instance";r="string";d="";break;case "timeStart":b="timestamp";r="datetime";d="start";break;case "timeEnd":b="timestamp";r="datetime";d="end";break;case "deviceID":b="property";r="string";d="deviceid";break;case "userID":b="property",r="string",d="username"}b&&m.setVal(w[b]({param:d,
curVal:k,dataNode:m}),null,r)})},timestamp:function(a){var b;return"start"===a.param?0<a.curVal.length?a.curVal:t.evaluate("now()","string"):"end"===a.param?(h.on("beforesave",function(){b=t.evaluate("now()","string");a.dataNode.setVal(b,null,"datetime")}),t.evaluate("now()","string")):"error - unknown timestamp parameter"},date:function(a){var b,d;return 0===a.curVal.length?(b=new Date(t.evaluate("today()","string")),a=b.getFullYear().toString().pad(4),d=(b.getMonth()+1).toString().pad(2),b=b.getDate().toString().pad(2),
a+"-"+d+"-"+b):a.curVal},property:function(a){var b,d;b=function(a,b,e,d){if(p)return p[a];b=document.cookie.split("; ");p={};for(d=b.length-1;0<=d;d--)e=b[d].split("="),e[1]=decodeURIComponent(e[1]),"s:"===e[1].substr(0,2)&&(e[1]=e[1].slice(2),e[1]=e[1].slice(0,e[1].lastIndexOf("."))),p[e[0]]=decodeURIComponent(e[1]);return p[a]};if(0===a.curVal.length){d="no "+a.param+" property in enketo";switch(a.param){case "deviceid":a=b("__enketo_meta_deviceid")||"Error: could not determine deviceID";break;
case "username":a=b("__enketo_meta_uid");break;default:a=d}return a}return a.curVal},context:function(a){return 0===a.curVal.length?"application"===a.param?"enketo":a.param+" not supported in enketo":a.curVal},patient:function(a){return 0===a.curVal.length?"patient preload not supported in enketo":a.curVal},user:function(a){return 0===a.curVal.length?"user preload item not supported in enketo yet":a.curVal},uid:function(a){return 0===a.curVal.length?"no uid yet in enketo":a.curVal},instance:function(a){a=
0<a.curVal.length?a.curVal:t.evaluate('concat("uuid:", uuid())',"string");h.data({instanceID:a});return a}};b.prototype.repeat={init:function(a){var b,d,g,k,l,m,p,r=this;this.formO=a;h.find(".or-repeat").prepend('<span class="repeat-number"></span>');h.find(".or-repeat:not([data-repeat-fixed])").append('<div class="repeat-buttons"><button type="button" class="btn btn-default repeat"><i class="icon icon-plus"> </i></button><button type="button" disabled class="btn btn-default remove"><i class="icon icon-minus"> </i></button></div>');
h.on("click","button.repeat:enabled",function(){r.clone(f(this).closest(".or-repeat"));return!1});h.on("click","button.remove:enabled",function(){r.remove(f(this).closest(".or-repeat.clone"));return!1});l=function(a,e){d=a.attr("data-repeat-count")||"";b=0<d.length?parseInt(t.node(d).getVal()[0],10):0;p=h.find('.or-repeat[name="'+a.attr("name")+'"]').index(a);m=t.node(a.attr("name"),p).get();g=m.siblings(m.prop("nodeName")).addBack().length;k=b>g?b:g;1<k&&r.clone(a.siblings().addBack().last(),k-1,
!0);a.siblings(".or-repeat").addBack().find(".or-repeat").filter(function(){return f(this).parentsUntil(".or",".or-repeat").length===e}).each(function(){l(f(this),e+1)})};h.find(".or-repeat").filter(function(){return 0===f(this).parentsUntil(".or",".or-repeat").length}).each(function(){l(f(this),1)})},clone:function(a,b,d){var g,l,m,p,r=this;b=b||1;if(1!==a.length)return console.error("Nothing to clone"),!1;g=a.siblings(".or-repeat");l=a.hasClass("clone")?g.not(".clone").eq(0):a;m=l.clone(!0,!0);
p=l.attr("name");m.addClass("clone").find(".clone").remove();m.find(".invalid-required, .invalid-constraint").find("input, select, textarea").each(function(){r.formO.setValid(f(this))});l=h.find('.or-repeat[name="'+p+'"]').index(a);m.clearInputs("");for(b+=l;l<b;l++)m.find(".option-wrapper").each(this.fixRadioNames),d||k.destroy(m),m.insertAfter(a),0<p.length&&0<=l&&t.cloneRepeat(p,l),m.trigger("addrepeat",l+1),d?r.formO.calcUpdate({repeatPath:p,repeatIndex:l+1}):k.init(m),g=g.add(m),m=m.clone();
a=g.add(a).add(g.find(".or-repeat"));this.numberRepeats(a);this.toggleButtons(a);return!0},remove:function(a){var b=this,d=a.prev(".or-repeat"),f=a.attr("name"),g=h.find('.or-repeat[name="'+f+'"]').index(a),k=a.siblings(".or-repeat");a.hide(600,function(){a.remove();b.numberRepeats(k);b.toggleButtons(k);d.trigger("removerepeat");t.node(f,g).remove()})},fixRadioNames:function(a,b){f(b).find('input[type="radio"]').attr("name",Math.floor(1E7*Math.random()+1))},toggleButtons:function(a){var b,d;a=a&&
0!==a.length?a:h;a.each(function(){b=f(this);d=b.siblings(".or-repeat").addBack();d.children(".repeat-buttons").find("button.repeat, button.remove").prop("disabled",!0);d.last().children(".repeat-buttons").find("button.repeat").prop("disabled",!1);d.children(".repeat-buttons").find("button.remove").not(":first").prop("disabled",!1)})},numberRepeats:function(a){a.each(function(){var a,b,d,e=f(this);0===e.prev(".or-repeat").length&&(a=f(this).siblings(".or-repeat"),b=a.length+1,1<b?(e.find(".repeat-number").text("1"),
d=2,a.each(function(){f(this).find(".repeat-number").eq(0).text(d);d++})):e.find(".repeat-number").eq(0).empty())})}};b.prototype.setEventHandlers=function(){var a=this;h.attr("onsubmit","return false;");h.on("blur",'input:not([type="text"], [type="radio"], [type="checkbox"])',function(){var a=f(this);"undefined"!==typeof a.prop("validity").badInput&&a.prop("validity").badInput&&a.val("")});h.on("change.file validate","input:not(.ignore), select:not(.ignore), textarea:not(.ignore)",function(b){var d,
g,k=f(this),l=a.input.getName(k),m=a.input.getInputType(k),p=a.input.getXmlType(k),r=a.input.isEnabled(k);d=a.input.getConstraint(k);var u=a.input.getVal(k),w=a.input.isRequired(k),K,P=function(){g||(K=a.input.getIndex(k),g=t.node(l,K));return g};0<u.length&&"file"===m&&k[0].files[0]&&0<k[0].files[0].size&&(u=k[0].files[0].name);"validate"===b.type?d=r&&"hidden"!==m?d||"string"!==p&&"select"!==p&&"select1"!==p&&"binary"!==p?P().validate(d,p):!0:!0:(d=P().setVal(u,d,p),d=!1!==d||"geotrace"!==p&&"geoshape"!==
p?d:null);!1===!(r&&"hidden"!==m&&w&&0===P().getVal()[0].length)?(a.setValid(k,"constraint"),"validate"===b.type&&a.setInvalid(k,"required")):(a.setValid(k,"required"),"undefined"!==typeof d&&!1===d?a.setInvalid(k,"constraint"):null!==d&&a.setValid(k,"constraint"));"change"===b.type&&h.trigger("valuechange.enketo")});h.on("focus fakefocus","input:not(.ignore), select:not(.ignore), textarea:not(.ignore)",function(b){a.progress.update(b.target)});h.on("focus blur fakefocus fakeblur","input:not(.ignore), select:not(.ignore), textarea:not(.ignore)",
function(b){var d=f(this),g=a.input.getProps(d),h=d.closest(".question"),k=h.find("legend").eq(0),l=h.hasClass("invalid-required")||h.hasClass("invalid-constraint"),d=0<d.parentsUntil(".or",".or-appearance-list-nolabel").length,m=h.find(".required-subtle"),p=f('<span class="required-subtle" style="color: transparent;">Required</span>');if("focusin"===b.type||"fakefocus"===b.type)h.addClass("focus"),g.required&&0===m.length&&!d&&(m=f(p),0<k.length?k.append(m):m.insertBefore(this),l||m.show(function(){f(this).removeAttr("style")}));
else if("focusout"===b.type||"fakeblur"===b.type)h.removeClass("focus"),g.required&&0<g.val.length?m.remove():l||m.removeAttr("style")});t.$.on("dataupdate",function(b,d){a.calcUpdate(d);a.branchUpdate(d);a.outputUpdate(d);a.itemsetUpdate(d);a.editStatus.set(!0)});h.on("addrepeat",function(b,d){var g=f(b.target);a.setAllVals(g,d);a.calcUpdate({repeatPath:g.attr("name"),repeatIndex:d});a.progress.update()});h.on("removerepeat",function(){a.progress.update()});h.on("changelanguage",function(){a.outputUpdate()})};
b.prototype.setValid=function(a,b){var d=b?"invalid-"+b:"invalid-constraint invalid-required";this.input.getWrapNodes(a).removeClass(d)};b.prototype.setInvalid=function(a,b){b=b||"constraint";this.input.getWrapNodes(a).addClass("invalid-"+b).find(".required-subtle").attr("style","color: transparent;")};b.prototype.validateAll=function(){var a,b=this;h.find("fieldset:disabled input, fieldset:disabled select, fieldset:disabled textarea, input:disabled, select:disabled, textarea:disabled").each(function(){b.setValid(f(this))});
h.find(".question").each(function(){f(this).find("input:not(.ignore):not(:disabled), select:not(.ignore):not(:disabled), textarea:not(.ignore):not(:disabled)").eq(0).trigger("validate")});a=h.find(".invalid-required, .invalid-constraint").eq(0);0<a.length&&window.scrollTo&&(this.pages.active&&this.pages.flipToPageContaining(a),window.scrollTo(0,a.offset().top-50));return 0===a.length};b.prototype.progress={status:0,lastChanged:null,$all:null,updateTotal:function(){this.$all=h.find(".question").not(".disabled").filter(function(){return 0===
f(this).parentsUntil(".or",".disabled").length})},update:function(a){this.$all&&a||this.updateTotal();this.lastChanged=a||this.lastChanged;a=Math.round(100*(this.$all.index(f(this.lastChanged).closest(".question"))+1)/this.$all.length);0<a&&a!==this.status&&(this.status=a,h.trigger("progressupdate.enketo",a))},get:function(){return this.status}};b.prototype.isValid=function(){return 0<h.find(".invalid-required, .invalid-constraint").length?!1:!0};b.prototype.addPageBreaks=function(){}}});
